
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport d'Audit Performance - Mathildanesth</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #333; }
        .summary { background: #e8f4fd; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .metric { display: inline-block; margin: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; min-width: 150px; text-align: center; }
        .good { border-left: 4px solid #28a745; }
        .warning { border-left: 4px solid #ffc107; }
        .poor { border-left: 4px solid #dc3545; }
        .error { border-left: 4px solid #dc3545; background: #f8d7da; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .recommendations { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .timestamp { color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Rapport d'Audit Performance</h1>
        <p class="timestamp">Généré le : 26/05/2025 16:55:07</p>
        
        <div class="summary">
            <h2>📊 Résumé</h2>
            <div class="metric">
                <strong>Taille Bundle</strong><br>
                4.07 GB
            </div>
            <div class="metric">
                <strong>Gros Fichiers</strong><br>
                42
            </div>
            <div class="metric">
                <strong>Problèmes Perf</strong><br>
                3
            </div>
        </div>

        <h2>📦 Analyse des Bundles</h2>
        
            <p><strong>Taille totale :</strong> 4.07 GB</p>
            
                <h3>Fichiers volumineux :</h3>
                <table>
                    <tr><th>Fichier</th><th>Taille</th></tr>
                    
                        <tr><td>static/chunks/_app-pages-browser_src_components_notifications_SimulationNotifications_tsx.js</td><td>2.59 MB</td></tr>
                    
                        <tr><td>static/chunks/_app-pages-browser_src_modules_leaves_components_LeaveForm_tsx.js</td><td>4.27 MB</td></tr>
                    
                        <tr><td>static/chunks/main-app.js</td><td>6.35 MB</td></tr>
                    
                        <tr><td>static/chunks/app/layout.js</td><td>4.82 MB</td></tr>
                    
                        <tr><td>static/chunks/app/page.js</td><td>2.49 MB</td></tr>
                    
                        <tr><td>static/chunks/app/utilisateurs/page.js</td><td>3.47 MB</td></tr>
                    
                        <tr><td>static/chunks/app/planning/hebdomadaire/page.js</td><td>6.71 MB</td></tr>
                    
                        <tr><td>static/chunks/app/parametres/page.js</td><td>3.3 MB</td></tr>
                    
                        <tr><td>static/chunks/app/leaves/page.js</td><td>3.48 MB</td></tr>
                    
                        <tr><td>static/chunks/app/calendar/page.js</td><td>8.92 MB</td></tr>
                    
                        <tr><td>static/chunks/app/auth/login/page.js</td><td>648.84 KB</td></tr>
                    
                        <tr><td>static/chunks/app/admin/bloc-operatoire/page.js</td><td>574.83 KB</td></tr>
                    
                        <tr><td>static/chunks/app/admin/bloc-operatoire/secteurs/page.js</td><td>3.1 MB</td></tr>
                    
                        <tr><td>static/chunks/app/admin/bloc-operatoire/salles/page.js</td><td>3.78 MB</td></tr>
                    
                        <tr><td>static/chunks/app/admin/bloc-operatoire/regles-supervision/page.js</td><td>3.86 MB</td></tr>
                    
                        <tr><td>server/middleware.js</td><td>2.45 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/@fullcalendar.js</td><td>1.61 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/@mui.js</td><td>1.44 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/@radix-ui.js</td><td>671.66 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/engine.io-client.js</td><td>610.63 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/engine.io.js</td><td>770.83 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/framer-motion.js</td><td>973.41 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/motion-dom.js</td><td>510.81 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/next-auth.js</td><td>1.13 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/next.js</td><td>4.93 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/openid-client.js</td><td>992.44 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/react-beautiful-dnd.js</td><td>642.21 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/react-datepicker.js</td><td>1.77 MB</td></tr>
                    
                        <tr><td>server/vendor-chunks/socket.io-adapter.js</td><td>520.18 KB</td></tr>
                    
                        <tr><td>server/vendor-chunks/zod.js</td><td>524.99 KB</td></tr>
                    
                        <tr><td>server/app/page.js</td><td>1.1 MB</td></tr>
                    
                        <tr><td>server/app/utilisateurs/page.js</td><td>1.31 MB</td></tr>
                    
                        <tr><td>server/app/planning/hebdomadaire/page.js</td><td>1.68 MB</td></tr>
                    
                        <tr><td>server/app/parametres/page.js</td><td>1.2 MB</td></tr>
                    
                        <tr><td>server/app/leaves/page.js</td><td>1.18 MB</td></tr>
                    
                        <tr><td>server/app/calendar/page.js</td><td>2.07 MB</td></tr>
                    
                        <tr><td>server/app/auth/login/page.js</td><td>1.01 MB</td></tr>
                    
                        <tr><td>server/app/admin/bloc-operatoire/page.js</td><td>1.01 MB</td></tr>
                    
                        <tr><td>server/app/admin/bloc-operatoire/secteurs/page.js</td><td>1.63 MB</td></tr>
                    
                        <tr><td>server/app/admin/bloc-operatoire/salles/page.js</td><td>1.69 MB</td></tr>
                    
                        <tr><td>server/app/admin/bloc-operatoire/regles-supervision/page.js</td><td>1.74 MB</td></tr>
                    
                        <tr><td>server/app/_not-found/page.js</td><td>973.78 KB</td></tr>
                    
                </table>
            
        

        <h2>⚡ Tests de Performance</h2>
        
            <div class="metric error">
                <strong>Build Time</strong><br>
                22.91s<br>
                <small>error</small>
                <br><small style="color: red;">Command failed: npm run build
Failed to compile.

./src/app/planning/validation/page.tsx
Module not found: Can't resolve '@hello-pangea/dnd'

https://nextjs.org/docs/messages/module-not-found


> Build failed because of webpack errors
</small>
            </div>
        
            <div class="metric error">
                <strong>TypeScript Check</strong><br>
                30.05s<br>
                <small>error</small>
                <br><small style="color: red;">spawnSync /bin/sh ETIMEDOUT</small>
            </div>
        
            <div class="metric error">
                <strong>Test Suite</strong><br>
                22.26s<br>
                <small>error</small>
                <br><small style="color: red;">Command failed: npm run test:critical
(node:82652) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:82646) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:82650) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts
  LeavePermissionService (Tests avancés)
    Cache de permissions
      ✕ devrait invalider le cache d'un utilisateur (22 ms)
      ✕ devrait configurer le cache avec les options fournies (1 ms)
    Permissions relatives
      ✓ devrait correctement gérer les permissions d'équipe
      ✓ devrait correctement gérer les permissions de département (1 ms)
      ✓ devrait identifier correctement les permissions relatives
    Permissions personnalisées
      ✓ devrait accorder des permissions spéciales à un employé standard
      ✓ devrait refuser des permissions normalement accordées à un rôle
      ✓ devrait retourner la liste complète des permissions d'un utilisateur (1 ms)
    Gestion des événements et du bus d'événements
      ✓ devrait s'abonner aux événements d'audit pour la gestion du cache (1 ms)
      ✓ devrait invalider le cache lors d'un changement de permission (2 ms)
    Méthodes de gestion de permissions
      ✓ devrait accorder une permission et journaliser l'action (7 ms)
      ✓ devrait révoquer une permission et journaliser l'action (6 ms)
      ✓ devrait réinitialiser les permissions personnalisées d'un utilisateur (1 ms)
      ✓ devrait gérer les erreurs lors de l'octroi/révocation de permissions (6 ms)

  ● LeavePermissionService (Tests avancés) › Cache de permissions › devrait invalider le cache d'un utilisateur

    Property `delete` does not exist in the provided object

      186 |             // Arrange
      187 |             const userId = mockEmployee.id;
    > 188 |             const cacheSpy = jest.spyOn(permissionService['permissionCache'], 'delete');
          |                                   ^
      189 |
      190 |             // Act
      191 |             permissionService.invalidateUserCache(mockEmployee.id);

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts:188:35)

  ● LeavePermissionService (Tests avancés) › Cache de permissions › devrait configurer le cache avec les options fournies

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      212 |
      213 |             // Assert
    > 214 |             expect(optionsSpy).toHaveBeenCalled();
          |                                ^
      215 |
      216 |             // Note: Ne pas tester les stats ici car elles peuvent varier en fonction de l'environnement
      217 |             // et de l'ordre d'exécution des tests

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts:214:32)

FAIL src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts
  QuotaAdvancedService
    getActiveTransferRules
      ✓ devrait récupérer les règles de transfert actives (4 ms)
      ✓ devrait gérer les erreurs lors de la récupération des règles (4 ms)
    getActiveCarryOverRules
      ✓ devrait récupérer les règles de report actives (1 ms)
      ✓ devrait gérer les erreurs lors de la récupération des règles (1 ms)
    simulateTransfer
      ✓ devrait simuler un transfert valide avec application des règles
      ✓ devrait détecter un transfert invalide si le montant dépasse le quota disponible
    executeTransfer
      ✕ devrait exécuter un transfert valide (143 ms)
      ✓ devrait rejeter un transfert si la simulation échoue (1 ms)
    simulateCarryOver
      ✓ devrait simuler un report valide (1 ms)
      ✓ devrait calculer correctement un report avec pourcentage (5 ms)
    executeCarryOver
      ✕ devrait exécuter un report valide (15 ms)
      ✓ devrait rejeter un report si la simulation échoue (2 ms)
    getEnhancedQuotaState
      ✓ devrait récupérer et combiner les informations de quotas, transferts et reports (5 ms)
      ✓ devrait gérer une erreur lors de la récupération des données (1 ms)

  ● QuotaAdvancedService › executeTransfer › devrait exécuter un transfert valide

    AxiosError: Network Error

      305 |
      306 |             // Envoyer l'entrée à l'API
    > 307 |             const response = await axios.post(`${this.apiBaseUrl}/entries`, enhancedEntry, {
          |                              ^
      308 |                 headers: this.defaultHeaders
      309 |             });
      310 |

      at XMLHttpRequest.handleError (node_modules/axios/lib/adapters/xhr.js:110:14)
      at XMLHttpRequest.invokeTheCallbackFunction (node_modules/jsdom/lib/jsdom/living/generated/EventHandlerNonNull.js:14:28)
      at XMLHttpRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/create-event-accessor.js:35:32)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at XMLHttpRequestImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at fireAnEvent (node_modules/jsdom/lib/jsdom/living/helpers/events.js:18:36)
      at requestErrorSteps (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:131:3)
      at Object.dispatchError (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:60:3)
      at Request.<anonymous> (node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:121:14)
      at MockHttpSocket.emitEvent [as emit] (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:152:12)
      at Socket.emit (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:271:14)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at AuditService.createAuditEntry (src/modules/leaves/services/AuditService.ts:307:30)
      at QuotaAdvancedService.executeTransfer (src/modules/leaves/services/QuotaAdvancedService.ts:199:13)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts:294:28)

  ● QuotaAdvancedService › executeCarryOver › devrait exécuter un report valide

    AxiosError: Network Error

      305 |
      306 |             // Envoyer l'entrée à l'API
    > 307 |             const response = await axios.post(`${this.apiBaseUrl}/entries`, enhancedEntry, {
          |                              ^
      308 |                 headers: this.defaultHeaders
      309 |             });
      310 |

      at XMLHttpRequest.handleError (node_modules/axios/lib/adapters/xhr.js:110:14)
      at XMLHttpRequest.invokeTheCallbackFunction (node_modules/jsdom/lib/jsdom/living/generated/EventHandlerNonNull.js:14:28)
      at XMLHttpRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/create-event-accessor.js:35:32)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at XMLHttpRequestImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at fireAnEvent (node_modules/jsdom/lib/jsdom/living/helpers/events.js:18:36)
      at requestErrorSteps (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:131:3)
      at Object.dispatchError (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:60:3)
      at Request.<anonymous> (node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:121:14)
      at MockHttpSocket.emitEvent [as emit] (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:152:12)
      at Socket.emit (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:271:14)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at AuditService.createAuditEntry (src/modules/leaves/services/AuditService.ts:307:30)
      at QuotaAdvancedService.executeCarryOver (src/modules/leaves/services/QuotaAdvancedService.ts:359:13)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts:371:28)

(node:82649) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:82645) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:82648) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL src/modules/leaves/hooks/useLeaveQuota.test.ts
  useLeaveQuota
    ✓ devrait initialiser correctement l'état (11 ms)
    ✕ devrait charger les quotas de congés (20 ms)
    ✓ devrait récupérer le quota pour un type spécifique (14 ms)
    ✓ devrait vérifier si une demande respecte les quotas (9 ms)
    ✓ devrait rejeter une demande qui dépasse les quotas (7 ms)
    ✓ devrait gérer les erreurs lors du chargement des quotas (10 ms)

  ● useLeaveQuota › devrait charger les quotas de congés

    expect(received).toBe(expected) // Object.is equality

    Expected: 12
    Received: 10

       99 |         expect(result.current.totalBalance.pending).toBe(5);
      100 |         expect(result.current.totalBalance.remaining).toBe(20);
    > 101 |         expect(result.current.quotasByType.length).toBe(12); // Mise à jour pour tous les types incluant PATERNITY et PARENTAL
          |                                                    ^
      102 |     });
      103 |
      104 |     it('devrait récupérer le quota pour un type spécifique', async () => {

      at Object.<anonymous> (src/modules/leaves/hooks/useLeaveQuota.test.ts:101:52)

FAIL src/modules/leaves/services/quotaService.test.ts
  quotaService
    simulateQuotaTransfer
      ✓ calcule correctement un transfert simple (1:1) (1 ms)
      ✕ calcule correctement un transfert avec ratio personnalisé (1 ms)
      ✓ refuse le transfert si le montant est insuffisant
      ✓ utilise un ratio de 1:1 si aucune règle applicable n'est trouvée (1 ms)
    simulateCarryOverCalculation
      ✓ calcule correctement un report en pourcentage (50%) (1 ms)
      ✓ calcule correctement un report avec un montant fixe
      ✓ calcule correctement un report de tous les jours restants (1 ms)
    isTransferRuleApplicable
      ✓ retourne false si la règle est inactive
      ✓ retourne false si la date de début est future
      ✓ retourne false si la date de fin est passée
      ✓ retourne true pour une règle active sans restrictions de date (1 ms)
    isInSpecialPeriod
      ✓ identifie correctement une date dans une période simple
      ✓ gère correctement une période chevauchant deux années
      ✓ gère correctement une période récurrente (sans année spécifique)

  ● quotaService › simulateQuotaTransfer › calcule correctement un transfert avec ratio personnalisé

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 4

      112 |             expect(result.success).toBe(true);
      113 |             expect(result.sourceAmount).toBe(4);
    > 114 |             expect(result.targetAmount).toBe(2);
          |                                         ^
      115 |         });
      116 |
      117 |         it('refuse le transfert si le montant est insuffisant', async () => {

      at Object.<anonymous> (src/modules/leaves/services/quotaService.test.ts:114:41)

(node:82647) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL src/modules/leaves/hooks/useConflictDetection.test.ts
  useConflictDetection
    ✕ devrait initialiser correctement le hook (3 ms)
    validateDates
      ✕ devrait valider correctement des dates valides (1 ms)
      ✕ devrait rejeter des dates invalides - startDate null (1 ms)
      ✕ devrait rejeter des dates invalides - endDate null
      ✕ devrait rejeter des dates invalides - date de début après date de fin
      ✕ devrait rejeter des dates lorsque la validation échoue
    checkConflicts
      ✕ devrait vérifier les conflits et mettre à jour l'état - sans conflits
      ✕ devrait vérifier les conflits et mettre à jour l'état - avec conflits
      ✕ devrait gérer les erreurs lors de la vérification des conflits
      ✕ devrait rejeter avec une erreur si les dates sont invalides (1 ms)
      ✕ ne devrait pas appeler checkLeaveConflicts si les dates sont invalides
      ✕ devrait mettre à jour les conflits lorsque le service renvoie des conflits (1 ms)
      ✕ devrait gérer les erreurs du service
      ✕ ne devrait pas appeler le service si les dates sont invalides
    getConflictsByType
      ✕ devrait filtrer les conflits par type
    resolveConflict
      ✕ devrait supprimer un conflit et mettre à jour l'état des conflits bloquants
    resetConflicts
      ✕ devrait réinitialiser l'état des conflits
  Integration useConflictDetection avec useDateValidation
    ✓ devrait vérifier les conflits et gérer la validation des dates (426 ms)

  ● useConflictDetection › devrait initialiser correctement le hook

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait valider correctement des dates valides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - startDate null

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - endDate null

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - date de début après date de fin

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates lorsque la validation échoue

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait vérifier les conflits et mettre à jour l'état - sans conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait vérifier les conflits et mettre à jour l'état - avec conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait gérer les erreurs lors de la vérification des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait rejeter avec une erreur si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › ne devrait pas appeler checkLeaveConflicts si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait mettre à jour les conflits lorsque le service renvoie des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait gérer les erreurs du service

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › ne devrait pas appeler le service si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › getConflictsByType › devrait filtrer les conflits par type

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › resolveConflict › devrait supprimer un conflit et mettre à jour l'état des conflits bloquants

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › resetConflicts › devrait réinitialiser l'état des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

FAIL src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts
  LeavePermissionService
    getInstance
      ✓ devrait retourner une instance singleton (31 ms)
    hasPermission
      ✓ devrait accorder les permissions de base à un employé standard (1 ms)
      ✓ devrait refuser les permissions administratives à un employé standard (2 ms)
      ✓ devrait accorder des permissions de management à un manager (2 ms)
      ✓ devrait accorder toutes les permissions à un administrateur système (3 ms)
      ✓ devrait prendre en compte les permissions personnalisées accordées (2 ms)
      ✓ devrait prendre en compte les permissions personnalisées refusées (1 ms)
      ✓ devrait vérifier les permissions relatives à l'équipe correctement (1 ms)
    hasPermissions
      ✓ devrait vérifier que l'utilisateur a toutes les permissions (requireAll=true) (5 ms)
      ✓ devrait vérifier que l'utilisateur a au moins une permission (requireAll=false) (1 ms)
    grantPermission
      ✕ devrait accorder une permission à un utilisateur (3 ms)
      ✕ devrait retourner false si l'API échoue (16 ms)
    revokePermission
      ✕ devrait révoquer une permission d'un utilisateur (1 ms)
      ✕ devrait retourner false si l'API échoue (3 ms)
    getUserPermissions
      ✕ devrait retourner toutes les permissions d'un utilisateur (2 ms)
      ✓ devrait retourner un tableau vide si l'API échoue (1 ms)
    resetUserPermissions
      ✕ devrait réinitialiser les permissions personnalisées d'un utilisateur (2 ms)
      ✕ devrait retourner false si l'API échoue (3 ms)

  ● LeavePermissionService › grantPermission › devrait accorder une permission à un utilisateur

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      344 |
      345 |             // Assert
    > 346 |             expect(result).toBe(true);
          |                            ^
      347 |             expect(mockFetch).toHaveBeenCalledWith(
      348 |                 `/api/leaves/permissions/${userId}/grant`,
      349 |                 expect.objectContaining({

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:346:28)

  ● LeavePermissionService › grantPermission › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "permission": "leaves.reports.view", "userId": "test-user"}

    Number of calls: 0

      383 |             expect(result).toBe(false);
      384 |             expect(mockFetch).toHaveBeenCalledTimes(1);
    > 385 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      386 |                 expect.anything(), // AuditActionType.PERMISSION_GRANT_FAILED - utiliser expect.anything() pour l'instant
      387 |                 expect.stringContaining('Échoué (API: 500)'),
      388 |                 expect.anything(), // AuditSeverity.ERROR - utiliser expect.anything() pour l'instant

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:385:66)

  ● LeavePermissionService › revokePermission › devrait révoquer une permission d'un utilisateur

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      410 |
      411 |             // Assert
    > 412 |             expect(result).toBe(true);
          |                            ^
      413 |             expect(mockFetch).toHaveBeenCalledWith(
      414 |                 `/api/leaves/permissions/${userId}/revoke`,
      415 |                 expect.objectContaining({

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:412:28)

  ● LeavePermissionService › revokePermission › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "permission": "leaves.reports.view", "userId": "test-user"}

    Number of calls: 0

      445 |             expect(result).toBe(false);
      446 |             expect(mockFetch).toHaveBeenCalledTimes(1);
    > 447 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      448 |                 expect.anything(),
      449 |                 expect.stringContaining('Échoué (API: 500)'),
      450 |                 expect.anything(),

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:447:66)

  ● LeavePermissionService › getUserPermissions › devrait retourner toutes les permissions d'un utilisateur

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 1

    - Array [
    -   "leaves.reports.view",
    -   "leaves.request",
    - ]
    + Array []

      471 |             // Assert
      472 |             expect(mockFetch).toHaveBeenCalledWith(`/api/users/${userId}`);
    > 473 |             expect(permissions).toEqual(mockPermissions);
          |                                 ^
      474 |         });
      475 |
      476 |         it('devrait retourner un tableau vide si l\'API échoue', async () => {

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:473:33)

  ● LeavePermissionService › resetUserPermissions › devrait réinitialiser les permissions personnalisées d'un utilisateur

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/permissions/custom-user-123/reset", ObjectContaining {"method": "POST"}
    Received: "/api/leaves/permissions/custom-user-123", {"method": "DELETE"}

    Number of calls: 1

      533 |             // Assert
      534 |             expect(result).toBe(true);
    > 535 |             expect(mockFetch).toHaveBeenCalledWith(
          |                               ^
      536 |                 `/api/leaves/permissions/${userId}/reset`,
      537 |                 expect.objectContaining({ method: 'POST' })
      538 |             );

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:535:31)

  ● LeavePermissionService › resetUserPermissions › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "userId": "test-user"}

    Number of calls: 0

      553 |             // Assert
      554 |             expect(result).toBe(false);
    > 555 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      556 |                 expect.anything(), // AuditActionType.PERMISSION_RESET_FAILED
      557 |                 expect.stringContaining('Échoué (API: 500)'),
      558 |                 expect.anything(), // AuditSeverity.ERROR

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:555:66)

FAIL src/lib/auth/__tests__/authorization.test.ts
  Authorization Module
    hasRole
      ✓ devrait autoriser un admin total à accéder aux ressources admin (7 ms)
      ✓ devrait autoriser un admin partiel aux ressources appropriées (1 ms)
      ✓ devrait limiter un utilisateur normal aux ressources utilisateur
      ✓ devrait refuser l'accès aux utilisateurs inactifs (1 ms)
      ✓ devrait refuser l'accès si l'utilisateur est null
    hasPermission
      ✓ devrait vérifier les permissions spécifiques
      ✓ devrait refuser les permissions aux utilisateurs inactifs
      ✓ devrait refuser les permissions si l'utilisateur est null
    canAccessResource
      ✓ devrait permettre aux admins d'accéder à toutes les ressources (1 ms)
      ✓ devrait permettre aux utilisateurs d'accéder à leurs propres ressources
      ✓ devrait refuser l'accès aux ressources d'autres utilisateurs
      ✓ devrait refuser l'accès aux utilisateurs inactifs
    canManageLeaves
      ✓ devrait permettre aux admins de gérer les congés
      ✓ devrait permettre aux secrétaires de gérer les congés
      ✓ devrait refuser la gestion des congés aux utilisateurs normaux
      ✓ devrait refuser la gestion des congés aux utilisateurs inactifs (1 ms)
    canManagePlanning
      ✓ devrait permettre seulement aux admins totaux de gérer les plannings
      ✓ devrait refuser la gestion des plannings aux utilisateurs inactifs
    canViewReports
      ✓ devrait permettre aux admins de voir les rapports (1 ms)
      ✓ devrait permettre aux secrétaires de voir les rapports
      ✓ devrait refuser l'accès aux rapports aux utilisateurs normaux (8 ms)
      ✓ devrait refuser l'accès aux rapports aux utilisateurs inactifs (2 ms)
    Scénarios complexes d'autorisation
      ✓ devrait gérer les autorisations en cascade (1 ms)
      ✓ devrait gérer les autorisations basées sur le rôle professionnel (2 ms)
      ✓ devrait gérer les autorisations temporaires (2 ms)
    Tests de performance d'autorisation
      ✓ devrait vérifier les autorisations rapidement
      ✓ devrait gérer efficacement de nombreux utilisateurs (4 ms)
    Tests de sécurité
      ✓ devrait résister aux tentatives de contournement
      ✕ devrait valider tous les paramètres d'entrée (1 ms)
      ✓ devrait empêcher l'escalade de privilèges

  ● Authorization Module › Tests de sécurité › devrait valider tous les paramètres d'entrée

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      370 |
      371 |             // Test avec des rôles invalides
    > 372 |             expect(hasRole(regularUser, 'INVALID_ROLE')).toBe(false);
          |                                                          ^
      373 |         });
      374 |
      375 |         it('devrait empêcher l\'escalade de privilèges', () => {

      at Object.<anonymous> (src/lib/auth/__tests__/authorization.test.ts:372:58)

(node:82651) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts
  ConflictRecommendationService
    getInstance
      ✓ devrait retourner une instance singleton (3 ms)
    analyzeConflicts
      ✓ devrait retourner un résultat vide si aucun conflit n'est fourni (11 ms)
      ✓ devrait analyser tous les conflits et générer des recommandations (5 ms)
      ✕ devrait identifier correctement les résolutions automatiques possibles (4 ms)
      ✓ devrait calculer correctement la distribution des priorités (2 ms)
      ✓ devrait identifier correctement les conflits les plus prioritaires (2 ms)
    updateRules
      ✕ devrait mettre à jour les règles et émettre un événement (1 ms)
    resetRulesToDefault
      ✕ devrait réinitialiser les règles aux valeurs par défaut
    Méthodes privées - via type assertion
      determineConflictPriority
        ✓ devrait utiliser les règles de priorité spécifiques si disponibles
        ✓ devrait ajuster la priorité pour les utilisateurs avec rôles prioritaires
      generateResolutionStrategies
        ✓ devrait générer des stratégies différentes selon le type de conflit (1 ms)

  ● ConflictRecommendationService › analyzeConflicts › devrait identifier correctement les résolutions automatiques possibles

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      134 |
      135 |             // Vérifier que l'événement a été émis pour les résolutions automatiques
    > 136 |             expect(mockEventBus.emit).toHaveBeenCalled();
          |                                       ^
      137 |         });
      138 |
      139 |         it('devrait calculer correctement la distribution des priorités', () => {

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:136:39)

  ● ConflictRecommendationService › updateRules › devrait mettre à jour les règles et émettre un événement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"updatedBy": "user", "updatedRules": ["priorityRules"]}, "type": "conflict.rules.updated"}

    Number of calls: 0

      186 |
      187 |             // Vérifier que l'événement a été émis
    > 188 |             expect(mockEventBus.emit).toHaveBeenCalledWith({
          |                                       ^
      189 |                 type: 'conflict.rules.updated',
      190 |                 data: {
      191 |                     updatedRules: Object.keys(newRules),

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:188:39)

  ● ConflictRecommendationService › resetRulesToDefault › devrait réinitialiser les règles aux valeurs par défaut

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"resetToDefault": true, "updatedBy": "user", "updatedRules": ["all"]}, "type": "conflict.rules.updated"}

    Number of calls: 0

      215 |
      216 |             // Vérifier que l'événement a été émis
    > 217 |             expect(mockEventBus.emit).toHaveBeenCalledWith({
          |                                       ^
      218 |                 type: 'conflict.rules.updated',
      219 |                 data: {
      220 |                     updatedRules: ['all'],

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:217:39)

FAIL src/modules/leaves/services/leaveCalculator.test.ts
  leaveCalculator
    calculateLeaveCountedDays
      ✕ devrait calculer correctement les jours pour une période standard (2 ms)
      ✕ devrait calculer correctement une demi-journée du matin
      ✕ devrait calculer correctement une demi-journée de l'après-midi (1 ms)
      ✕ devrait ignorer isHalfDay si startDate et endDate sont différents
      ✕ devrait prendre en compte les jours fériés (2 ms)
      ✓ devrait mettre en cache les résultats et les réutiliser (1 ms)
      ✓ devrait forcer le rafraîchissement du cache si demandé
    isBusinessDay
      ✓ devrait retourner false pour les weekends
      ✓ devrait retourner false pour les jours fériés (1 ms)
      ✓ devrait retourner true pour les jours ouvrables normaux

  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement les jours pour une période standard

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 0

      48 |
      49 |             expect(result).not.toBeNull();
    > 50 |             expect(result?.countedDays).toBe(5);
         |                                         ^
      51 |             expect(result?.naturalDays).toBe(5);
      52 |             expect(result?.halfDays).toBe(0);
      53 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:50:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement une demi-journée du matin

    expect(received).toBe(expected) // Object.is equality

    Expected: 0.5
    Received: 0

      63 |
      64 |             expect(result).not.toBeNull();
    > 65 |             expect(result?.countedDays).toBe(0.5);
         |                                         ^
      66 |             expect(result?.naturalDays).toBe(1);
      67 |             expect(result?.halfDays).toBe(1);
      68 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:65:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement une demi-journée de l'après-midi

    expect(received).toBe(expected) // Object.is equality

    Expected: 0.5
    Received: 0

      78 |
      79 |             expect(result).not.toBeNull();
    > 80 |             expect(result?.countedDays).toBe(0.5);
         |                                         ^
      81 |             expect(result?.naturalDays).toBe(1);
      82 |             expect(result?.halfDays).toBe(1);
      83 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:80:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait ignorer isHalfDay si startDate et endDate sont différents

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      94 |
      95 |             expect(result).not.toBeNull();
    > 96 |             expect(result?.countedDays).toBe(2); // Devrait compter 2 jours complets
         |                                         ^
      97 |             expect(result?.naturalDays).toBe(2);
      98 |             expect(result?.halfDays).toBe(0);
      99 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:96:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait prendre en compte les jours fériés

    expect(received).toBe(expected) // Object.is equality

    Expected: 4
    Received: 0

      115 |
      116 |             expect(result).not.toBeNull();
    > 117 |             expect(result?.countedDays).toBe(4); // 5 jours - 1 jour férié
          |                                         ^
      118 |             expect(result?.naturalDays).toBe(5);
      119 |         });
      120 |

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:117:41)

FAIL src/modules/leaves/hooks/useLeave.test.ts
  useLeave Hook
    ✕ should initialize with null leave and empty leaves array when no initialLeave provided (97 ms)
    ✓ should initialize with initialLeave when provided (2 ms)
    updateLeaveField
      ✓ should update a simple field like reason (1 ms)
      ✓ should update startDate and recalculate countedDays if schedule exists (2 ms)
      ✓ should update endDate and recalculate countedDays if schedule exists (2 ms)
      ✓ should NOT recalculate countedDays if schedule is missing
      ✓ should NOT recalculate countedDays if start date becomes after end date (2 ms)
      ✓ should update type without recalculating days (1 ms)
    calculateLeaveDuration
      ✓ should call calculateLeaveDays with correct dates and schedule (2 ms)
      ✓ should return 0 if schedule is missing
      ✓ should return 0 if dates are missing (1 ms)
    checkConflicts
      ✓ should correctly call checkLeaveConflicts with Date objects when passed ISO strings (1 ms)
      ✓ should handle invalid dates and set error without calling the service (9 ms)
      ✕ should call checkLeaveConflicts service with Date objects and update state on success (6 ms)
      ✓ should call setError with warning when conflicts are present but not blocking (2 ms)
      ✓ should call setError with error severity when conflicts are blocking (3 ms)
      ✓ should set error state if checkLeaveConflicts service fails (2 ms)
      ✕ should return null if userId is missing (3 ms)
      ✓ should handle errors correctly (1 ms)
    checkAllowance
      ✓ should call checkLeaveAllowance service and update state on success (7 ms)
      ✓ should set error state if checkLeaveAllowance service fails (4 ms)
      ✓ should handle errors correctly (2 ms)
      ✓ should throw an error if required data (type) is missing (17 ms)
      ✓ should throw an error if required data (countedDays) is missing (10 ms)
    saveLeaveAsDraft
      ✓ should call saveLeave service with DRAFT status and update state (4 ms)
      ✓ should set error state if saveLeave service fails (4 ms)
      ✓ should throw an error if leave state is null (4 ms)
    submitLeave
      ✓ should call submitLeaveRequest service with PENDING status and update state (2 ms)
      ✓ should set error state if submitLeaveRequest service fails (2 ms)
      ✓ should throw an error if required data (type) is missing (4 ms)
    approveLeaveRequest
      ✓ should call approveLeave service and update state on success (1 ms)
      ✓ should set error state if approveLeave service fails (6 ms)
      ✓ should throw an error if leave id is missing (3 ms)
    rejectLeaveRequest
      ✓ should call rejectLeave service and update state on success (1 ms)
      ✓ should set error state if rejectLeave service fails (3 ms)
      ✓ should throw an error if leave id is missing (1 ms)
    cancelLeaveRequest
      ✓ should call cancelLeave service and update state on success (2 ms)
      ✓ should set error state if cancelLeave service fails (5 ms)
      ✓ should throw an error if leave id is missing (1 ms)
    fetchUserLeaves
      ✓ should call fetchLeaves service and update leaves state on success (1 ms)
      ✓ should call fetchLeaves service with provided filters (5 ms)
      ✕ should set error state if fetchLeaves service fails (5 ms)
    fetchLeaveDetails
      ✓ should call fetchLeaveById service and update leave state on success (1 ms)
      ✕ should set error state if fetchLeaveById service fails (1 ms)

  ● useLeave Hook › should initialize with null leave and empty leaves array when no initialLeave provided

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      172 |         expect(result.current.leave).toBeNull();
      173 |         expect(result.current.leaves).toEqual([]);
    > 174 |         expect(result.current.loading).toBe(false);
          |                                        ^
      175 |         expect(result.current.error).toBeNull();
      176 |         expect(result.current.conflictCheckResult).toBeNull();
      177 |         expect(result.current.allowanceCheckResult).toBeNull();

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:174:40)

  ● useLeave Hook › checkConflicts › should call checkLeaveConflicts service with Date objects and update state on success

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      461 |
      462 |             // Vérifier que loading était true pendant l'appel
    > 463 |             expect(loadingDuringCall).toBe(true);
          |                                       ^
      464 |
      465 |             // Vérifier les états après l'appel
      466 |             expect(result.current.loading).toBe(false);

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:463:39)

  ● useLeave Hook › checkConflicts › should return null if userId is missing

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: 2024-09-01T22:00:00.000Z, 2024-09-05T22:00:00.000Z, "user123", "leave-initial"

      589 |
      590 |             // Vérifier que le service n'a pas été appelé
    > 591 |             expect(mockedCheckLeaveConflicts).not.toHaveBeenCalled();
          |                                                   ^
      592 |
      593 |             // Vérifier que setError a été appelé avec les informations appropriées
      594 |             expect(mockedSetError).toHaveBeenCalledWith(

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:591:51)

  ● useLeave Hook › fetchUserLeaves › should set error state if fetchLeaves service fails

    Fetch leaves failed

      1097 |
      1098 |         it('should set error state if fetchLeaves service fails', async () => {
    > 1099 |             const mockError = new Error('Fetch leaves failed');
           |                               ^
      1100 |             mockedFetchLeaves.mockRejectedValueOnce(mockError);
      1101 |
      1102 |             const { result } = renderHook(() => useLeave({ userId: mockUserId }));

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1099:31)

  ● useLeave Hook › fetchUserLeaves › should set error state if fetchLeaves service fails

    expect(received).toEqual(expected) // deep equality

    - Expected  -  1
    + Received  + 14

    - Array []
    + Array [
    +   Object {
    +     "countedDays": 5,
    +     "createdAt": 2024-07-31T22:00:00.000Z,
    +     "endDate": 2024-09-05T22:00:00.000Z,
    +     "id": "leave-initial",
    +     "requestDate": 2024-07-31T22:00:00.000Z,
    +     "startDate": 2024-09-01T22:00:00.000Z,
    +     "status": "DRAFT",
    +     "type": "ANNUAL",
    +     "updatedAt": 2024-07-31T22:00:00.000Z,
    +     "userId": "user123",
    +   },
    + ]

      1119 |                 severity: 'error'
      1120 |             });
    > 1121 |             expect(result.current.leaves).toEqual([]); // Liste reste vide
           |                                           ^
      1122 |         });
      1123 |     });
      1124 |

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1121:43)

  ● useLeave Hook › fetchLeaveDetails › should set error state if fetchLeaveById service fails

    Fetch details failed

      1146 |         it('should set error state if fetchLeaveById service fails', async () => {
      1147 |             const specificLeaveId = 'leave-fail';
    > 1148 |             const mockError = new Error('Fetch details failed');
           |                               ^
      1149 |             mockedFetchLeaveById.mockRejectedValueOnce(mockError);
      1150 |
      1151 |             const { result } = renderHook(() => useLeave({ userId: mockUserId }));

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1148:31)

(node:82644) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/modules/leaves/hooks/useLeaveCalculation.test.ts
  useLeaveCalculation
    ✓ should return initial state correctly (2 ms)
    ✓ should calculate details when valid dates and schedule are provided (6 ms)
    ✓ should load public holidays within the date range (4 ms)
    ✓ should handle calculation options like countHalfDays (3 ms)
    ✓ should set status to error if calculateLeaveCountedDays throws (5 ms)
    ✓ should use externalWorkSchedule if provided (2 ms)
    ✓ should allow recalculation (7 ms)
    ✓ should set status to loading when work schedule is loading (3 ms)
    ✓ should set status to error if work schedule fetch fails (1 ms)
    ✓ should not calculate if dates are invalid (endDate before startDate) (4 ms)
    ✓ should correctly recalculate when recalculate is called (7 ms)
    ✓ should handle undefined result from calculateLeaveCountedDays gracefully (4 ms)
    ✓ should not trigger calculation if workSchedule is initially null and dates are present (1 ms)
    ✓ should have isLoading true and status loading if workSchedule is loading, even with dates (1 ms)

PASS src/modules/leaves/hooks/useLeaveValidation.test.ts
  useLeaveValidation
    ✓ devrait valider une demande de congé correcte (5 ms)
    ✓ devrait rejeter une demande avec une date dans le passé (2 ms)
    ✓ devrait rejeter une demande où la date de fin est avant la date de début (2 ms)
    ✓ devrait rejeter une demande qui dépasse le quota disponible (2 ms)
    ✓ devrait valider une demande qui respecte le quota disponible (2 ms)
    ✓ devrait réinitialiser toutes les erreurs (1 ms)
    ✓ devrait rejeter une demande avec dates null ou undefined (3 ms)
    ✓ devrait fournir des messages d'erreur corrects (2 ms)
    ✓ devrait correctement gérer les périodes d'exclusion (blackout) (2 ms)
    ✓ devrait mettre à jour correctement le contexte via setContext (5 ms)
    ✓ devrait gérer correctement les propriétés d'utilisateur null (3 ms)

PASS src/modules/leaves/components/LeaveCard.test.tsx
  LeaveCard
    ✓ renders correctly with pending status (25 ms)
    ✓ does not show action buttons when status is not PENDING (3 ms)
    ✓ calls onEdit when edit button is clicked (5 ms)
    ✓ calls onCancel when cancel button is clicked (3 ms)
    ✓ calls onView when the card is clicked (5 ms)
    ✓ shows expanded content when isExpanded is true and content exists (6 ms)
    ✓ does not show action buttons when showActions is false (7 ms)

PASS src/modules/leaves/services/__tests__/leaveService.integration.test.ts
  Leave Workflow Integration Tests
    Workflow complet de demande de congé
      ✓ devrait permettre de créer, approuver et suivre une demande de congé (3 ms)
      ✓ devrait rejeter une demande si quota insuffisant
      ✓ devrait détecter les conflits de dates (1 ms)
    Gestion des congés récurrents
      ✓ devrait créer plusieurs occurrences pour un congé récurrent (1 ms)
    Calculs de jours ouvrés
      ✓ devrait calculer correctement les jours ouvrés en excluant les week-ends
      ✓ devrait gérer les jours fériés
    Gestion des quotas avancée
      ✓ devrait gérer le report de congés d'une année sur l'autre (1 ms)
      ✓ devrait calculer les quotas pour temps partiel
    Tests de performance
      ✓ devrait traiter efficacement de gros volumes de congés (26 ms)
      ✓ devrait calculer rapidement les conflits sur une grande période (3 ms)

PASS src/modules/leaves/__tests__/integration/riskDetectionSystem.test.ts
  Système de détection des risques - Tests d'intégration
    Détection des périodes à risque
      ✓ devrait détecter une période à risque pendant les vacances d'été (2 ms)
      ✓ devrait réagir à la création d'un congé en analysant les périodes à risque (1 ms)
      ✓ devrait détecter les périodes à risque CRITICAL avec un score élevé
    Gestion des périodes à risque
      ✓ devrait récupérer les périodes à risque actuelles
      ✓ devrait récupérer les périodes à risque à venir (1 ms)
      ✓ devrait désactiver une période à risque
    Performance du système de détection
      ✓ devrait analyser les périodes à risque en moins de 500ms (1 ms)
      ✓ devrait gérer efficacement un grand nombre d'événements consécutifs (1 ms)
    Intégration avec le système de gestion des conflits
      ✓ devrait émettre un événement quand une nouvelle période à risque est détectée (1 ms)
      ✓ devrait mettre à jour les données historiques lors de la résolution d'un conflit

FAIL src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx
  useQuotaTransfer
    ✕ devrait charger les données initiales (1020 ms)
    ✕ devrait calculer correctement les types disponibles (6 ms)
    ✕ devrait simuler un transfert correctement (37 ms)
    ✕ devrait exécuter un transfert correctement (6 ms)
    ✓ devrait retourner une erreur si le transfert n'est pas autorisé (8 ms)
    ✕ devrait gérer les erreurs de transfert (7 ms)
    ○ skipped devrait gérer les erreurs du service de solde

  ● useQuotaTransfer › devrait charger les données initiales

    expect(received).not.toBeNull()

    Received: null

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      130 |         expect(result.current.error).toBeNull();
      131 |
    > 132 |         await waitFor(() => expect(result.current.balance).not.toBeNull());
          |                                                                ^
      133 |
      134 |         // Vérifier l'état après chargement
      135 |         expect(result.current.loading).toBe(false);

      at src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:132:64
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useQuotaTransfer › devrait calculer correctement les types disponibles

    expect(received).toContain(expected) // indexOf

    Expected value: "ANNUAL"
    Received array: []

      151 |
      152 |         // Vérifier les types sources disponibles
    > 153 |         expect(result.current.availableSourceTypes).toContain(LeaveType.ANNUAL);
          |                                                     ^
      154 |         expect(result.current.availableSourceTypes).toContain(LeaveType.RECOVERY);
      155 |
      156 |         // Vérifier les types cibles disponibles par source

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:153:53)

  ● useQuotaTransfer › devrait simuler un transfert correctement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"sourceAmount": 5, "sourceType": "RECOVERY", "targetType": "ANNUAL", "userId": "mock-user-id"}, [{"createdAt": 2025-05-26T14:56:03.078Z, "id": "rule-1", "isActive": true, "name": "Récupération vers Congés Annuels", "ratio": 1, "ruleType": "STANDARD", "sourceType": "RECOVERY", "targetType": "ANNUAL", "updatedAt": 2025-05-26T14:56:03.078Z}]

    Number of calls: 0

      188 |
      189 |         // Vérifier les appels et le résultat
    > 190 |         expect(previewQuotaTransfer).toHaveBeenCalledWith(transferRequest, applicableRules);
          |                                      ^
      191 |         expect(simulationResult).toMatchObject({
      192 |             success: true,
      193 |             sourceAmount: 5,

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:190:38)

  ● useQuotaTransfer › devrait exécuter un transfert correctement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"sourceAmount": 5, "sourceType": "RECOVERY", "targetType": "ANNUAL", "userId": "mock-user-id"}

    Number of calls: 0

      221 |
      222 |         // Vérifier les appels et le résultat
    > 223 |         expect(transferQuota).toHaveBeenCalledWith(transferRequest);
          |                               ^
      224 |         expect(fetchLeaveBalance).toHaveBeenCalledTimes(2);
      225 |         expect(transferResult).toEqual(mockTransferResult);
      226 |     });

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:223:31)

  ● useQuotaTransfer › devrait gérer les erreurs de transfert

    expect(received).toBe(expected) // Object.is equality

    Expected: "Erreur lors du transfert"
    Received: "Aucune règle de transfert n'est disponible pour Récupération vers Congés annuels"

      304 |         expect(transferResult.success).toBe(false);
      305 |         expect(result.current.transferError).toBeInstanceOf(Error);
    > 306 |         expect(result.current.transferError?.message).toBe(errorMessage);
          |                                                       ^
      307 |     });
      308 | }); 

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:306:55)

PASS src/modules/leaves/services/leaveService.test.ts
  leaveService
    formatLeavePeriod
      ✓ should format the period correctly
    getLeaveTypeLabel
      ✓ should return correct labels for known types (1 ms)
      ✓ should return the type itself for unknown types
    getLeaveStatusLabel
      ✓ should return correct labels for known statuses
      ✓ should return the status itself for unknown statuses (1 ms)
    fetchLeaves
      ✓ should call prisma.leave.count and prisma.leave.findMany with default parameters
      ✓ should apply filters correctly to prisma queries (2 ms)
    submitLeaveRequest
      ✓ should submit a leave request (1 ms)
    calculateLeaveDays
      ✓ should calculate leave days based on schedule (5 ms)

PASS src/modules/leaves/components/__tests__/LeaveRequestForm.test.tsx
  LeaveRequestForm Component
    ✓ should call saveDraft when draft button is clicked (17 ms)
    ✓ should call submitLeave when submit button is clicked (5 ms)
    ✓ should call cancel when cancel button is clicked (3 ms)
    ✓ should display proper user ID in the form (1 ms)
    ✓ renders the mocked form structure (5 ms)

PASS src/modules/leaves/services/__tests__/AuditService.test.ts
  AuditService
    getInstance
      ✓ devrait retourner une instance singleton
    initEventSubscriptions
      ✓ devrait s'abonner aux événements du bus d'événements (1 ms)
    createAuditEntry
      ✓ devrait créer une entrée d'audit via l'API (1 ms)
      ✓ devrait gérer les erreurs lors de la création (3 ms)
    handleLeaveEvent
      ✓ devrait créer une entrée d'audit pour un événement de congé (13 ms)
      ✓ devrait créer des entrées d'audit avec la bonne sévérité selon le type d'événement (1 ms)
      ✓ devrait gérer les erreurs lors du traitement d'un événement de congé
    handleQuotaEvent
      ✓ devrait créer une entrée d'audit pour un événement de quota
      ✓ devrait générer des descriptions spécifiques pour chaque type d'événement de quota (1 ms)
    handleGenericAuditEvent
      ✓ devrait traiter correctement les événements d'audit génériques
      ✓ devrait gérer les erreurs lors du traitement d'un événement d'audit générique
    mapIntegrationEventToAuditType
      ✓ devrait mapper correctement les types d'événements d'intégration vers les types d'audit (1 ms)
      ✓ devrait retourner null pour les types d'événements non mappés
    searchAuditEntries
      ✓ devrait rechercher des entrées d'audit avec les filtres spécifiés (1 ms)
      ✓ devrait gérer les options de tri dans la recherche
      ✓ devrait gérer les erreurs lors de la recherche
    getAuditEntry
      ✓ devrait récupérer une entrée d'audit par ID
      ✓ devrait gérer les erreurs lors de la récupération d'une entrée d'audit (1 ms)
    méthodes de journalisation spécifiques
      ✓ devrait journaliser l'accès au système
      ✓ devrait journaliser les changements de rôle utilisateur (3 ms)
      ✓ devrait journaliser les changements de permission
      ✓ devrait journaliser l'exportation de données
      ✓ devrait journaliser les changements de configuration

PASS src/modules/leaves/services/__tests__/quotaManagementService.test.ts
  ✓ should run (1 ms)
  QuotaManagementService
    ✓ doit être un singleton
    ✓ doit récupérer les règles de transfert (1 ms)
    ✓ doit gérer les erreurs lors de la récupération des règles (4 ms)
    ✓ devrait simuler un transfert de quota avec succès (1 ms)
    ✓ doit gérer les erreurs lors de la simulation de transfert
    ✓ doit demander un transfert avec succès (1 ms)
    ✓ doit gérer les erreurs lors de la demande de transfert (1 ms)
    ✓ doit récupérer l'historique des transferts
    ✓ doit gérer les erreurs lors de la récupération de l'historique (1 ms)
    ✓ doit approuver un transfert avec succès (2 ms)
    ✓ doit gérer les échecs d'approbation
    ✓ doit rejeter un transfert avec succès (1 ms)
    ✓ doit gérer les échecs de rejet
    getCarryOverRules
      ✓ doit récupérer les règles de report avec succès (1 ms)
      ✓ doit gérer les erreurs lors de la récupération des règles de report
    requestCarryOver
      ✓ doit demander un report avec succès
      ✓ doit gérer les erreurs lors de la demande de report (5 ms)
    processCarryOverRequest
      ✓ doit traiter une demande de report (approbation) avec succès (1 ms)
      ✓ doit gérer les erreurs lors du traitement d'une demande de report

PASS src/modules/leaves/components/LeaveRequestForm.test.tsx
  LeaveRequestForm Component
    ✓ should render form correctly (246 ms)
    ✓ should validate dates when date fields change (44 ms)
    ✓ should validate the leave request when both dates are set and form is submitted (33 ms)
    ✓ should display field error messages when validation fails on submit (19 ms)

PASS src/modules/leaves/services/__tests__/leaveCalculator.test.ts
  Leave Calculator Service
    calculateLeaveCountedDays
      ✓ devrait calculer correctement les jours pour une période standard (14 ms)
      ✓ devrait calculer correctement les jours ouvrables pour une période incluant un weekend (2 ms)
      ✓ devrait prendre en compte les jours fériés (3 ms)
      ✓ devrait gérer les demi-journées (1 ms)
      ✓ devrait respecter l'emploi du temps à temps partiel (3 ms)
      ✓ devrait gérer les jours fériés tombant un weekend (2 ms)
      ✓ devrait utiliser le cache pour des appels répétés avec les mêmes paramètres (1 ms)
      ✓ devrait gérer les erreurs correctement (1 ms)
      ✓ devrait calculer correctement une demi-journée du matin (1 ms)
      ✓ devrait calculer correctement une demi-journée de l'après-midi (1 ms)
      ✓ devrait ignorer isHalfDay si startDate et endDate sont différents (2 ms)
    calculateWorkingDays
      ✓ devrait calculer correctement les jours ouvrables
      ✓ devrait exclure les weekends (1 ms)
      ✓ devrait exclure les jours fériés (1 ms)
    isBusinessDay
      ✓ devrait identifier correctement les jours ouvrables (4 ms)
      ✓ devrait gérer les dates invalides

PASS src/modules/leaves/hooks/useLeaveListFilteringSorting.test.ts
  useLeaveListFilteringSorting Hook
    Sorting Logic
      ✓ should sort by startDate descending by default (if initial state requires) (2 ms)
      ✓ should sort by startDate ascending (1 ms)
      ✓ should sort by user name ascending (handling different name structures) (10 ms)
      ✓ should sort by user name descending
      ✓ should sort by type ascending (1 ms)
      ✓ should sort by status descending (1 ms)
    Filtering Logic
      ✓ should filter by user name (partial, case-insensitive) (7 ms)
      ✓ should filter by exact type (1 ms)
      ✓ should filter by exact status (1 ms)
      ✓ should filter by exact startDate (YYYY-MM-DD)
      ✓ should filter by reason (partial, case-insensitive) (1 ms)
      ✓ should combine multiple filters (user and status)
      ✓ should return all leaves if filter is empty (1 ms)
      ✓ should return empty array if no leaves match
    Combined Logic and Edge Cases
      ✓ should filter then sort (1 ms)
      ✓ should handle empty leaves array input

PASS src/modules/leaves/services/__tests__/notificationEventService.test.ts
  NotificationEventService
    Singleton Pattern
      ✓ should always return the same instance
    handleLeaveCreated
      ✓ should notify when a leave is created (1 ms)
      ✓ should handle errors gracefully (1 ms)
    handleLeaveStatusChanged
      ✓ should notify when leave status changes (1 ms)
    handleLeaveConflict
      ✓ should notify when there is a leave conflict
    handleQuotaUpdated
      ✓ should notify when quota is low
      ✓ should not notify when quota is above threshold
    configuration
      ✓ should update notification configuration
    checkUpcomingLeaves
      ✓ should send reminders for upcoming leaves
      ✓ should not send reminders for non-approved leaves

PASS src/modules/leaves/utils/__tests__/dateCalculations.test.ts
  calculateCountedDays
    ✓ should return 5 for a full work week (Mon-Fri) (1 ms)
    ✓ should return 0 if endDate is before startDate
    ✓ should exclude weekends by default (Fri-Mon period)
    ✓ should include weekends if excludeWeekends is false
    ✓ should return 0 for a period covering only weekend days
    ✓ should exclude a public holiday falling on a weekday (1 ms)
    ✓ should exclude multiple public holidays on weekdays
    ✓ should correctly handle public holiday on a weekend (no double exclusion, weekend already excluded)
    ✓ should not exclude public holiday on a weekend if weekends are included
    ✓ should return 1 for a single weekday (not holiday)
    ✓ should return 0 for a single weekend day
    ✓ should return 0 for a single weekday public holiday
    ✓ should return 0 for a single weekend public holiday
    ✓ should return 1 for a single weekend day if weekends are included and not a holiday
    ✓ should return 0 for a single weekend day if weekends are included BUT it IS a holiday
    ✓ should return 0 for a period of only public holidays on weekdays
    ✓ should handle dates crossing month boundaries
    ✓ should handle dates crossing year boundaries
    ✓ should handle empty publicHolidays array correctly (1 ms)
    ✓ should normalize start and end dates to midnight for calculation
  calculateCountedDays - Half Days
    ✓ should return 0.5 for a half day on a weekday (AM)
    ✓ should return 0.5 for a half day on a weekday (PM)
    ✓ should return 0 for a half day on a Saturday
    ✓ should return 0 for a half day on a Sunday (1 ms)
    ✓ should return 0 for a half day on a public holiday (weekday)
    ✓ should return 0 for a half day on a public holiday (weekend - already excluded by weekend rule)
    ✓ should return 0.5 if excludeWeekends is false for a half day on a weekend (not holiday)
    ✓ should return 0 if excludeWeekends is false for a half day on a weekend THAT IS a public holiday
    ✓ halfDayPeriod AM or PM should give same result for counted days (0.5 or 0) (1 ms)

PASS src/modules/leaves/api/__tests__/LeaveReportApi.test.ts
  LeaveReportApi
    getInstance
      ✓ devrait retourner une instance singleton (1 ms)
    normalizeDateParam
      ✓ devrait formater correctement les dates (2 ms)
    getReportData
      ✓ devrait récupérer des données de rapport correctement
      ✓ devrait gérer les erreurs lors de la récupération de rapports (2 ms)
    méthodes de rapport spécifiques
      ✓ devrait appeler getReportData avec le bon type pour getLeaveUsageReport
      ✓ devrait appeler getReportData avec le bon type pour getLeaveBalanceReport
      ✓ devrait appeler getReportData avec le bon type pour getLeaveDistributionReport (1 ms)
      ✓ devrait appeler getReportData avec le bon type pour getDepartmentComparisonReport
      ✓ devrait appeler getReportData avec le bon type pour getLeaveHistoryReport
      ✓ devrait appeler getReportData avec le bon type pour getApprovalTimeReport
      ✓ devrait appeler getReportData avec le bon type pour getQuotaTransfersReport
    getCustomReport
      ✓ devrait appeler l'API avec une requête personnalisée (2 ms)
    exportReport
      ✓ devrait lancer une tâche d'exportation (1 ms)
    getExportStatus
      ✓ devrait récupérer le statut d'une tâche d'exportation
    downloadExportedFile
      ✓ devrait télécharger un fichier exporté (1 ms)

FAIL src/modules/leaves/services/conflictDetectionService.test.ts
  ● Test suite failed to run

    Configuration error:

    Could not locate module @/modules/teams/services/teamService mapped as:
    /Users/vincentperreard/Mathildanesth/src/modules/$1.

    Please check your configuration for these entries:
    {
      "moduleNameMapper": {
        "/^@\/modules\/(.*)$/": "/Users/vincentperreard/Mathildanesth/src/modules/$1"
      },
      "resolver": undefined
    }

       8 |
       9 | jest.mock('../../../services/userService');
    > 10 | jest.mock('@/modules/teams/services/teamService');
         |      ^
      11 | jest.mock('../../../utils/performanceLogger');
      12 |
      13 | const MockUserService = UserService as jest.MockedClass<typeof UserService>;

      at createNoMappedModuleFoundError (node_modules/jest-resolve/build/resolver.js:759:17)
      at Object.<anonymous> (src/modules/leaves/services/conflictDetectionService.test.ts:10:6)

FAIL src/modules/leaves/services/__tests__/leaveService.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'serviceMocks_1' before initialization

      36 | // Mock Prisma
      37 | jest.mock('@/lib/prisma', () => ({
    > 38 |     prisma: mockPrismaClient,
         |             ^
      39 | }));
      40 |
      41 | // Mock des utilitaires

      at src/modules/leaves/services/__tests__/leaveService.test.ts:38:13
      at Object.require (src/modules/leaves/services/leaveService.ts:43:1)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/leaveService.test.ts:7:1)

FAIL src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts
  ● Test suite failed to run

    Cannot find module '../../profiles/services/workScheduleService' from 'src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts'

      13 | import { TestFactory } from '@/tests/factories/testFactorySimple';
      14 | import { publicHolidayService } from '../publicHolidayService';
    > 15 | import { isWorkingDay } from '../../profiles/services/workScheduleService';
         | ^
      16 | import { WorkSchedule, WorkFrequency } from '../../profiles/types/workSchedule';
      17 | import { getLogger } from '@/utils/logger';
      18 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts:15:1)

FAIL src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts (5.422 s)
  ○ skipped should be implemented properly
  useConflictDetection
    ✕ devrait initialiser correctement l'état et vérifier les conflits (1018 ms)
    ✓ devrait gérer les erreurs lors de la vérification des conflits (315 ms)
  useConflictDetection - resolveConflict
    ✕ devrait appeler le service (indirectement) et mettre à jour l'état après résolution (1004 ms)
    ✕ devrait gérer les erreurs lors de la résolution (1004 ms)
  useConflictDetection - getConflictsByType
    ✕ devrait filtrer les conflits par type (1003 ms)

  ● useConflictDetection › devrait initialiser correctement l'état et vérifier les conflits

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      86 |
      87 |         // Attendre la fin du chargement
    > 88 |         await waitFor(() => expect(result.current.loading).toBe(false));
         |                                                            ^
      89 |
      90 |         // Assert : vérifier que la méthode du *service* a été appelée (indirectement par le hook)
      91 |         // Il faut peut-être ajuster ce que le hook passe au service

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:88:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - resolveConflict › devrait appeler le service (indirectement) et mettre à jour l'état après résolution

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      160 |         // Charger les conflits initiaux en appelant checkConflicts avec des objets Date
      161 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 162 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      163 |         expect(result.current.conflicts).toEqual(initialConflictsResult.conflicts);
      164 |         expect(result.current.hasBlockingConflicts).toBe(true);
      165 |

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:162:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - resolveConflict › devrait gérer les erreurs lors de la résolution

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      202 |         // Charger les conflits initiaux en appelant checkConflicts avec des objets Date
      203 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 204 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      205 |
      206 |         // Act : Appeler resolveConflict du hook. On s'attend à ce qu'il échoue.
      207 |         // Pour simuler l'échec, on pourrait mocker une dépendance ou modifier le hook

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:204:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - getConflictsByType › devrait filtrer les conflits par type

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      244 |         // Charger les conflits en appelant checkConflicts avec des objets Date
      245 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 246 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      247 |
      248 |         // Act & Assert : Appeler getConflictsByType du *hook*
      249 |         expect(result.current.getConflictsByType(ConflictType.USER_LEAVE_OVERLAP)).toEqual([mockConflicts[0]]);

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:246:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

PASS src/modules/leaves/components/LeavesList.test.tsx
  <LeavesList /> Component
    ✓ should render table headers and filter inputs correctly (349 ms)
    ✓ should display leave data in table rows (48 ms)
    ✓ should display loading indicator when isLoading is true (28 ms)
    ✓ should display error message when error prop is provided (17 ms)
    ✓ should display empty state message when no leaves are found (after filtering) (16 ms)
    ✓ should call onEditLeaveClick when edit button is clicked (39 ms)
    ✓ should call onCancelLeaveClick when cancel button is clicked (41 ms)
    ✓ should disable edit button for leaves with non-PENDING status (37 ms)
    ✓ should disable cancel button for leaves with APPROVED or REJECTED status (37 ms)
    ✓ should filter leaves when user inputs a name (27 ms)
    ✓ should filter leaves by date range when date inputs change (35 ms)
    ✓ should change sort field when different column header is clicked (15 ms)
    ✓ should apply multiple filters simultaneously (23 ms)
    ✓ should clear filters when filter inputs are cleared (31 ms)
    ✓ should toggle sort direction when clicking the same column header twice (47 ms)
    ✓ should reset sort direction when changing sort field (61 ms)
    ✓ should maintain filters when changing sort criteria (64 ms)
    ✓ should maintain sort criteria when changing filters (48 ms)
    ✓ should show confirmation dialog when cancel button is clicked (35 ms)
    ✓ should handle null user properties gracefully (13 ms)
    ✓ should handle undefined user properties gracefully (13 ms)
    ✓ should display partial user name when only one name property exists (15 ms)
    ✓ should handle null or invalid dates gracefully (21 ms)
    ✓ should handle null or undefined user object (15 ms)
    ✓ should handle null or invalid dates gracefully (23 ms)
    ✓ should handle null or undefined leave objects in the list (14 ms)
    ✓ should handle a large number of leave items efficiently (1253 ms)
    ✓ should have proper accessibility attributes for the table (47 ms)
    ✓ should have focusable and operable interactive elements (34 ms)
    ✓ should handle keyboard navigation appropriately (31 ms)
    ✓ should handle null or undefined user object (13 ms)
    ✓ should handle null or invalid dates gracefully (20 ms)
    ○ skipped should filter leaves by type when type filter changes
    ○ skipped should filter leaves by status when status filter changes
    ○ skipped should sort leaves when sort field changes
    ○ skipped should sort by user and type columns when clicked
    Responsive behavior
      ✓ should adapt to mobile screens (16 ms)
      ✓ should show all columns on desktop screens (53 ms)
    Pagination functionality
      ✓ should handle a large number of leaves without crashing (38 ms)

FAIL src/modules/leaves/components/UserLeaveBalance.test.tsx (6.265 s)
  UserLeaveBalance Component
    ✕ affiche correctement les soldes de congés (1043 ms)
    ✕ affiche un message d'erreur si le chargement échoue (1005 ms)
    ✕ affiche un message si aucun solde n'est disponible (1003 ms)
    ✕ respecte l'option compact=true en masquant les détails (1003 ms)
    ✕ respecte l'option hideHeader=true (1003 ms)

  ● UserLeaveBalance Component › affiche correctement les soldes de congés

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      74 |
      75 |         expectToBeInDocument(screen.getByText('Chargement des soldes...'));
    > 76 |         await waitFor(() => {
         |                      ^
      77 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      78 |         });
      79 |

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:76:22)

  ● UserLeaveBalance Component › affiche un message d'erreur si le chargement échoue

    Unable to find an element with the text: Erreur. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

       97 |         mockedAxios.get.mockRejectedValueOnce(new Error('Network error'));
       98 |         render(<UserLeaveBalance userId={123} />);
    >  99 |         await waitFor(() => {
          |                      ^
      100 |             expectToBeInDocument(screen.getByText('Erreur'));
      101 |         });
      102 |         expectToBeInDocument(screen.getByText('Impossible de charger les soldes de congés'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:99:22)

  ● UserLeaveBalance Component › affiche un message si aucun solde n'est disponible

    Unable to find an element with the text: Aucun solde disponible. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      106 |         mockedAxios.get.mockResolvedValueOnce({ data: [] });
      107 |         render(<UserLeaveBalance userId={123} />);
    > 108 |         await waitFor(() => {
          |                      ^
      109 |             expectToBeInDocument(screen.getByText('Aucun solde disponible'));
      110 |         });
      111 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:108:22)

  ● UserLeaveBalance Component › respecte l'option compact=true en masquant les détails

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      114 |         mockedAxios.get.mockResolvedValueOnce({ data: mockBalanceData });
      115 |         render(<UserLeaveBalance userId={123} compact={true} />);
    > 116 |         await waitFor(() => {
          |                      ^
      117 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      118 |         });
      119 |         expectToBeInDocument(screen.getByText('15.5 jours'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:116:22)

  ● UserLeaveBalance Component › respecte l'option hideHeader=true

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      126 |         mockedAxios.get.mockResolvedValueOnce({ data: mockBalanceData });
      127 |         render(<UserLeaveBalance userId={123} hideHeader={true} />);
    > 128 |         await waitFor(() => {
          |                      ^
      129 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      130 |         });
      131 |         expectNotToBeInDocument(screen.queryByText('Soldes de congés'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:128:22)

FAIL src/modules/leaves/components/LeaveForm.test.tsx (12.75 s)
  LeaveForm
    ✓ should render initial form elements correctly (391 ms)
    ✓ should display loading state for leave types (9 ms)
    ✕ should handle error when loading leave types (1011 ms)
    ✕ should call useLeaveCalculation with initial dates and options (12 ms)
    ✕ should update useLeaveCalculation when dates change (9 ms)
    ✕ should handle half-day selection (38 ms)
    ✓ should display calculated days when hook returns success (9 ms)
    ✓ should display loading calculation state (7 ms)
    ✓ should display calculation error state (9 ms)
    ✕ should validate form on submit and show errors if invalid (1021 ms)
    Form Submission
      ✕ should submit valid data to /api/leaves/batch and handle success (1635 ms)
      ✕ should handle API error from /api/leaves/batch on submit (1599 ms)
      ✕ should handle general network error on submit (1617 ms)
      ✕ should not submit if calculation is not successful (3481 ms)

  ● LeaveForm › should handle error when loading leave types

    Unable to find an element with the display value: Erreur de chargement.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0mChargement...[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"endDate"[39m
                [36m>[39m
                  [0mDate de fin[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"endDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col space-y-4 p-4 bg-gray-50 rounded-md border border-gray-200"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center"[39m
                [36m>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mid[39m=[32m"isHalfDay"[39m
                    [33mname[39m=[32m"isHalfDay"[39m
                    [33mtype[39m=[32m"checkbox"[39m
                  [36m/>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"ml-2 block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"isHalfDay"[39m
                  [36m>[39m
                    [0mDemi-journée[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help ml-1"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3 mb-6"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"reason"[39m
                [36m>[39m
                  [0mMotif (optionnel)[0m
                [36m</label>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mMax. 200 caractères[0m
                [36m</span>[39m
              [36m</div>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"[39m
                [33mid[39m=[32m"reason"[39m
                [33mmaxlength[39m=[32m"200"[39m
                [33mname[39m=[32m"reason"[39m
                [33mplaceholder[39m=[32m"Précisez le motif de votre demande si nécessaire..."[39m
                [33mrows[39m=[32m"3"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex justify-end mt-8"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-opacity"[39m
              [33mdisabled[39m=[32m""[39m
              [33mtype[39m=[32m"submit"[39m
            [36m>[39m
              [0mSoumettre la demande[0m
            [36m</button>[39m
          [36m</div>[39m
        [36m</form>[39m
      [36m</div>[39m
    [36m</body>[39m

      258 |         (global.fetch as jest.Mock).mockRejectedValue(new Error('Failed to fetch types'));
      259 |         renderTheForm();
    > 260 |         await waitFor(() => {
          |                      ^
      261 |             expectToBeInDocument(screen.getByDisplayValue('Erreur de chargement'));
      262 |         });
      263 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:260:22)

  ● LeaveForm › should call useLeaveCalculation with initial dates and options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"endDate": null, "options": {"countHalfDays": false, "halfDayPeriod": undefined}, "startDate": null}
    Received
           1
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },
           2
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },

    Number of calls: 2

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:267:35)

  ● LeaveForm › should update useLeaveCalculation when dates change

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"endDate": null, "options": {"countHalfDays": false, "halfDayPeriod": undefined}, "startDate": null}
    Received
           1
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },
           2
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },

    Number of calls: 2

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:280:35)

  ● LeaveForm › should handle half-day selection

    expect(element).toBeChecked()

    Received element is not checked:
      <input class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" disabled="" id="isHalfDay" name="isHalfDay" type="checkbox" />

      73 |  */
      74 | export function expectToBeChecked(element: HTMLElement | null | undefined): void {
    > 75 |     expect(element).toBeChecked();
         |                     ^
      76 | }
      77 |
      78 | /**

      at expectToBeChecked (src/tests/utils/assertions.ts:75:21)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:346:26)

  ● LeaveForm › should validate form on submit and show errors if invalid

    Unable to find an element with the text: La date de début est requise.. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0mChargement...[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"endDate"[39m
                [36m>[39m
                  [0mDate de fin[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"endDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col space-y-4 p-4 bg-gray-50 rounded-md border border-gray-200"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center"[39m
                [36m>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mid[39m=[32m"isHalfDay"[39m
                    [33mname[39m=[32m"isHalfDay"[39m
                    [33mtype[39m=[32m"checkbox"[39m
                  [36m/>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"ml-2 block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"isHalfDay"[39m
                  [36m>[39m
                    [0mDemi-journée[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help ml-1"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3 mb-6"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"reason"[39m
                [36m>[39m
                  [0mMotif (optionnel)[0m
                [36m</label>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mMax. 200 caractères[0m
                [36m</span>[39m
              [36m</div>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"[39m
                [33mid[39m=[32m"reason"[39m
                [33mmaxlength[39m=[32m"200"[39m
                [33mname[39m=[32m"reason"[39m
                [33mplaceholder[39m=[32m"Précisez le motif de votre demande si nécessaire..."[39m
                [33mrows[39m=[32m"3"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex justify-end mt-8"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-opacity"[39m
              [33mdisabled[39m=[32m""[39m
              [33mtype[39m=[32m"submit"[39m
            [36m>[39m
              [0mSoumettre la demande[0m
            [36m</button>[39m
          [36m</div>[39m
        [36m</form>[39m
      [36m</div>[39m
    [36m</body>[39m

      406 |         await user.click(submitButton); // Soumission sans dates
      407 |
    > 408 |         expectToBeInDocument(await screen.findByText('La date de début est requise.'));
          |                                           ^
      409 |         expectToBeInDocument(screen.getByText('La date de fin est requise.'));
      410 |         expectNotToHaveBeenCalled(mockedAxios.post);
      411 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:32
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:408:43)

  ● LeaveForm › Form Submission › should submit valid data to /api/leaves/batch and handle success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", [ObjectContaining {"endDate": "2024-09-03", "reason": "Vacances annuelles", "startDate": "2024-09-02", "typeCode": "ANNUAL", "userId": 1}]

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:507:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should handle API error from /api/leaves/batch on submit

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", Any<Array>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:572:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should handle general network error on submit

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", Any<Array>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:611:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should not submit if calculation is not successful

    Unable to find an element with the text: /Calcul des jours en cours.../i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0m-- Sélectionner un type --[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"Congés annuels bruts"[39m
                    [33mvalue[39m=[32m"ANNUAL"[39m
                  [36m>[39m
                    [0mCongé annuel[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"RTT bruts"[39m
                    [33mvalue[39m=[32m"RTT"[39m
                  [36m>[39m
                    [0mRTT API (Raw)[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"Congé maladie brut"[39m
                    [33mvalue[39m=[32m"SICK"[39m
                  [36m>[39m
                    [0mMaladie[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed react-datepicker-ignore-onclickoutside"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"02/09/2024"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker__tab-loop"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__tab-loop__start"[39m
                      [33mtabindex[39m=[32m"0"[39m
                    [36m/>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-popper z-50"[39m
                      [33mdata-placement[39m=[32m"bottom"[39m
                      [33mstyle[39m=[32m"position: absolute; left: 0px; top: 0px; transform: translate(0px, 10px);"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mstyle[39m=[32m"display: contents;"[39m
                      [36m>[39m
                        [36m<div[39m
                          [33mstyle[39m=[32m"display: contents;"[39m
                        [36m>[39m
                          [36m<div[39m
                            [33maria-label[39m=[32m"Choose Date"[39m
                            [33maria-modal[39m=[32m"true"[39m
                            [33mclass[39m=[32m"react-datepicker shadow-lg rounded-md border bo...

      653 |             await fillDatesInForm(user, '02/09/2024', '03/09/2024');
      654 |             // Le hook est mocké pour retourner 'loading' avec ces dates.
    > 655 |             await screen.findByText(/Calcul des jours en cours.../i, {}, { timeout: 3000 });
          |                          ^
      656 |
      657 |             const submitButton = screen.getByText('Soumettre la demande');
      658 |             await user.click(submitButton);

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:32
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:655:26)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Jest: "global" coverage threshold for statements (75%) not met: 4.63%
Jest: "global" coverage threshold for branches (70%) not met: 3.19%
Jest: "global" coverage threshold for lines (75%) not met: 4.69%
Jest: "global" coverage threshold for functions (70%) not met: 3.29%
Jest: "src/modules/leaves/services/leaveService.ts" coverage threshold for statements (85%) not met: 29.66%
Jest: "src/modules/leaves/services/leaveService.ts" coverage threshold for branches (85%) not met: 20.93%
Jest: "src/modules/leaves/services/leaveService.ts" coverage threshold for lines (85%) not met: 26.41%
Jest: "src/modules/leaves/services/leaveService.ts" coverage threshold for functions (85%) not met: 13.15%
Jest: "src/modules/leaves/services/leaveCalculator.ts" coverage threshold for statements (85%) not met: 81.86%
Jest: "src/modules/leaves/services/leaveCalculator.ts" coverage threshold for branches (85%) not met: 64.84%
Jest: "src/modules/leaves/services/leaveCalculator.ts" coverage threshold for lines (85%) not met: 81.25%
Jest: "src/modules/leaves/services/quotaService.ts" coverage threshold for statements (80%) not met: 43.01%
Jest: "src/modules/leaves/services/quotaService.ts" coverage threshold for branches (80%) not met: 49.01%
Jest: "src/modules/leaves/services/quotaService.ts" coverage threshold for lines (80%) not met: 40.17%
Jest: "src/modules/leaves/services/quotaService.ts" coverage threshold for functions (80%) not met: 21.95%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authCache.ts" coverage threshold for statements (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authCache.ts" coverage threshold for branches (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authCache.ts" coverage threshold for lines (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authCache.ts" coverage threshold for functions (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authorization.ts" coverage threshold for statements (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authorization.ts" coverage threshold for branches (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authorization.ts" coverage threshold for lines (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/lib/auth/authorization.ts" coverage threshold for functions (80%) not met: 0%
Jest: "src/middleware/auth.ts" coverage threshold for statements (80%) not met: 0%
Jest: "src/middleware/auth.ts" coverage threshold for branches (80%) not met: 0%
Jest: "src/middleware/auth.ts" coverage threshold for lines (80%) not met: 0%
Jest: "src/middleware/auth.ts" coverage threshold for functions (80%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/hooks/useAuth.ts" coverage threshold for statements (75%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/hooks/useAuth.ts" coverage threshold for lines (75%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/hooks/useAuth.ts" coverage threshold for functions (75%) not met: 0%
Jest: "src/modules/planning/bloc-operatoire/services/blocPlanningService.ts" coverage threshold for statements (70%) not met: 0%
Jest: "src/modules/planning/bloc-operatoire/services/blocPlanningService.ts" coverage threshold for branches (70%) not met: 0%
Jest: "src/modules/planning/bloc-operatoire/services/blocPlanningService.ts" coverage threshold for lines (70%) not met: 0%
Jest: "src/modules/planning/bloc-operatoire/services/blocPlanningService.ts" coverage threshold for functions (70%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSectorModal.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSectorModal.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSectorModal.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSectorModal.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocFilterBar.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocFilterBar.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocFilterBar.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocFilterBar.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorsList.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorsList.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorsList.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorsList.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorRoomsDisplay.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorRoomsDisplay.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorRoomsDisplay.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SectorRoomsDisplay.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocPlanningCalendar.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocPlanningCalendar.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocPlanningCalendar.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/BlocPlanningCalendar.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/RoomsList.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/RoomsList.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/RoomsList.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/RoomsList.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomForm.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomForm.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomForm.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomForm.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddRoomModal.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddRoomModal.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddRoomModal.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddRoomModal.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomList.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomList.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomList.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingRoomList.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingSectorList.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingSectorList.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingSectorList.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/OperatingSectorList.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSupervisionRuleModal.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSupervisionRuleModal.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSupervisionRuleModal.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/AddSupervisionRuleModal.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesForm.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesForm.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesForm.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesForm.tsx" coverage threshold for functions (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesList.tsx" coverage threshold for statements (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesList.tsx" coverage threshold for branches (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesList.tsx" coverage threshold for lines (65%) not met: 0%
Jest: "/Users/vincentperreard/Mathildanesth/src/modules/planning/bloc-operatoire/components/SupervisionRulesList.tsx" coverage threshold for functions (65%) not met: 0%
Summary of all failing tests
FAIL src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts
  ● LeavePermissionService (Tests avancés) › Cache de permissions › devrait invalider le cache d'un utilisateur

    Property `delete` does not exist in the provided object

      186 |             // Arrange
      187 |             const userId = mockEmployee.id;
    > 188 |             const cacheSpy = jest.spyOn(permissionService['permissionCache'], 'delete');
          |                                   ^
      189 |
      190 |             // Act
      191 |             permissionService.invalidateUserCache(mockEmployee.id);

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:731:13)
      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts:188:35)

  ● LeavePermissionService (Tests avancés) › Cache de permissions › devrait configurer le cache avec les options fournies

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      212 |
      213 |             // Assert
    > 214 |             expect(optionsSpy).toHaveBeenCalled();
          |                                ^
      215 |
      216 |             // Note: Ne pas tester les stats ici car elles peuvent varier en fonction de l'environnement
      217 |             // et de l'ordre d'exécution des tests

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.extended.test.ts:214:32)

FAIL src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts
  ● QuotaAdvancedService › executeTransfer › devrait exécuter un transfert valide

    AxiosError: Network Error

      305 |
      306 |             // Envoyer l'entrée à l'API
    > 307 |             const response = await axios.post(`${this.apiBaseUrl}/entries`, enhancedEntry, {
          |                              ^
      308 |                 headers: this.defaultHeaders
      309 |             });
      310 |

      at XMLHttpRequest.handleError (node_modules/axios/lib/adapters/xhr.js:110:14)
      at XMLHttpRequest.invokeTheCallbackFunction (node_modules/jsdom/lib/jsdom/living/generated/EventHandlerNonNull.js:14:28)
      at XMLHttpRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/create-event-accessor.js:35:32)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at XMLHttpRequestImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at fireAnEvent (node_modules/jsdom/lib/jsdom/living/helpers/events.js:18:36)
      at requestErrorSteps (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:131:3)
      at Object.dispatchError (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:60:3)
      at Request.<anonymous> (node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:121:14)
      at MockHttpSocket.emitEvent [as emit] (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:152:12)
      at Socket.emit (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:271:14)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at AuditService.createAuditEntry (src/modules/leaves/services/AuditService.ts:307:30)
      at QuotaAdvancedService.executeTransfer (src/modules/leaves/services/QuotaAdvancedService.ts:199:13)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts:294:28)

  ● QuotaAdvancedService › executeCarryOver › devrait exécuter un report valide

    AxiosError: Network Error

      305 |
      306 |             // Envoyer l'entrée à l'API
    > 307 |             const response = await axios.post(`${this.apiBaseUrl}/entries`, enhancedEntry, {
          |                              ^
      308 |                 headers: this.defaultHeaders
      309 |             });
      310 |

      at XMLHttpRequest.handleError (node_modules/axios/lib/adapters/xhr.js:110:14)
      at XMLHttpRequest.invokeTheCallbackFunction (node_modules/jsdom/lib/jsdom/living/generated/EventHandlerNonNull.js:14:28)
      at XMLHttpRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/create-event-accessor.js:35:32)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
      at XMLHttpRequestImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
      at fireAnEvent (node_modules/jsdom/lib/jsdom/living/helpers/events.js:18:36)
      at requestErrorSteps (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:131:3)
      at Object.dispatchError (node_modules/jsdom/lib/jsdom/living/xhr/xhr-utils.js:60:3)
      at Request.<anonymous> (node_modules/jsdom/lib/jsdom/living/xhr/XMLHttpRequest-impl.js:655:18)
      at ClientRequest.<anonymous> (node_modules/jsdom/lib/jsdom/living/helpers/http-request.js:121:14)
      at MockHttpSocket.emitEvent [as emit] (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:152:12)
      at Socket.emit (node_modules/@mswjs/interceptors/src/interceptors/ClientRequest/MockHttpSocket.ts:271:14)
      at Axios.request (node_modules/axios/lib/core/Axios.js:45:41)
      at AuditService.createAuditEntry (src/modules/leaves/services/AuditService.ts:307:30)
      at QuotaAdvancedService.executeCarryOver (src/modules/leaves/services/QuotaAdvancedService.ts:359:13)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/QuotaAdvancedService.test.ts:371:28)

FAIL src/modules/leaves/hooks/useLeaveQuota.test.ts
  ● useLeaveQuota › devrait charger les quotas de congés

    expect(received).toBe(expected) // Object.is equality

    Expected: 12
    Received: 10

       99 |         expect(result.current.totalBalance.pending).toBe(5);
      100 |         expect(result.current.totalBalance.remaining).toBe(20);
    > 101 |         expect(result.current.quotasByType.length).toBe(12); // Mise à jour pour tous les types incluant PATERNITY et PARENTAL
          |                                                    ^
      102 |     });
      103 |
      104 |     it('devrait récupérer le quota pour un type spécifique', async () => {

      at Object.<anonymous> (src/modules/leaves/hooks/useLeaveQuota.test.ts:101:52)

FAIL src/modules/leaves/services/quotaService.test.ts
  ● quotaService › simulateQuotaTransfer › calcule correctement un transfert avec ratio personnalisé

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 4

      112 |             expect(result.success).toBe(true);
      113 |             expect(result.sourceAmount).toBe(4);
    > 114 |             expect(result.targetAmount).toBe(2);
          |                                         ^
      115 |         });
      116 |
      117 |         it('refuse le transfert si le montant est insuffisant', async () => {

      at Object.<anonymous> (src/modules/leaves/services/quotaService.test.ts:114:41)

FAIL src/modules/leaves/hooks/useConflictDetection.test.ts
  ● useConflictDetection › devrait initialiser correctement le hook

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait valider correctement des dates valides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - startDate null

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - endDate null

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates invalides - date de début après date de fin

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › validateDates › devrait rejeter des dates lorsque la validation échoue

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait vérifier les conflits et mettre à jour l'état - sans conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait vérifier les conflits et mettre à jour l'état - avec conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait gérer les erreurs lors de la vérification des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait rejeter avec une erreur si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › ne devrait pas appeler checkLeaveConflicts si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait mettre à jour les conflits lorsque le service renvoie des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › devrait gérer les erreurs du service

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › checkConflicts › ne devrait pas appeler le service si les dates sont invalides

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › getConflictsByType › devrait filtrer les conflits par type

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › resolveConflict › devrait supprimer un conflit et mettre à jour l'état des conflits bloquants

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

  ● useConflictDetection › resetConflicts › devrait réinitialiser l'état des conflits

    Cannot use spyOn on a primitive value; undefined given

      91 |         // Remplacer la vérification des dates dans le hook useConflictDetection avec une implémentation simplifiée
      92 |         // qui va toujours réussir pour les tests
    > 93 |         jest.spyOn(useConflictDetection.prototype as any, 'validateDates').mockImplementation(() => true);
         |              ^
      94 |     });
      95 |
      96 |     it('devrait initialiser correctement le hook', () => {

      at ModuleMocker.spyOn (node_modules/jest-mock/build/index.js:719:13)
      at Object.<anonymous> (src/modules/leaves/hooks/useConflictDetection.test.ts:93:14)

FAIL src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts
  ● LeavePermissionService › grantPermission › devrait accorder une permission à un utilisateur

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      344 |
      345 |             // Assert
    > 346 |             expect(result).toBe(true);
          |                            ^
      347 |             expect(mockFetch).toHaveBeenCalledWith(
      348 |                 `/api/leaves/permissions/${userId}/grant`,
      349 |                 expect.objectContaining({

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:346:28)

  ● LeavePermissionService › grantPermission › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "permission": "leaves.reports.view", "userId": "test-user"}

    Number of calls: 0

      383 |             expect(result).toBe(false);
      384 |             expect(mockFetch).toHaveBeenCalledTimes(1);
    > 385 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      386 |                 expect.anything(), // AuditActionType.PERMISSION_GRANT_FAILED - utiliser expect.anything() pour l'instant
      387 |                 expect.stringContaining('Échoué (API: 500)'),
      388 |                 expect.anything(), // AuditSeverity.ERROR - utiliser expect.anything() pour l'instant

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:385:66)

  ● LeavePermissionService › revokePermission › devrait révoquer une permission d'un utilisateur

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      410 |
      411 |             // Assert
    > 412 |             expect(result).toBe(true);
          |                            ^
      413 |             expect(mockFetch).toHaveBeenCalledWith(
      414 |                 `/api/leaves/permissions/${userId}/revoke`,
      415 |                 expect.objectContaining({

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:412:28)

  ● LeavePermissionService › revokePermission › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "permission": "leaves.reports.view", "userId": "test-user"}

    Number of calls: 0

      445 |             expect(result).toBe(false);
      446 |             expect(mockFetch).toHaveBeenCalledTimes(1);
    > 447 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      448 |                 expect.anything(),
      449 |                 expect.stringContaining('Échoué (API: 500)'),
      450 |                 expect.anything(),

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:447:66)

  ● LeavePermissionService › getUserPermissions › devrait retourner toutes les permissions d'un utilisateur

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 1

    - Array [
    -   "leaves.reports.view",
    -   "leaves.request",
    - ]
    + Array []

      471 |             // Assert
      472 |             expect(mockFetch).toHaveBeenCalledWith(`/api/users/${userId}`);
    > 473 |             expect(permissions).toEqual(mockPermissions);
          |                                 ^
      474 |         });
      475 |
      476 |         it('devrait retourner un tableau vide si l\'API échoue', async () => {

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:473:33)

  ● LeavePermissionService › resetUserPermissions › devrait réinitialiser les permissions personnalisées d'un utilisateur

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/permissions/custom-user-123/reset", ObjectContaining {"method": "POST"}
    Received: "/api/leaves/permissions/custom-user-123", {"method": "DELETE"}

    Number of calls: 1

      533 |             // Assert
      534 |             expect(result).toBe(true);
    > 535 |             expect(mockFetch).toHaveBeenCalledWith(
          |                               ^
      536 |                 `/api/leaves/permissions/${userId}/reset`,
      537 |                 expect.objectContaining({ method: 'POST' })
      538 |             );

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:535:31)

  ● LeavePermissionService › resetUserPermissions › devrait retourner false si l'API échoue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, StringContaining "Échoué (API: 500)", Anything, ObjectContaining {"granterId": "manager-456", "userId": "test-user"}

    Number of calls: 0

      553 |             // Assert
      554 |             expect(result).toBe(false);
    > 555 |             expect(mockAuditServiceInstance.logPermissionChange).toHaveBeenCalledWith(
          |                                                                  ^
      556 |                 expect.anything(), // AuditActionType.PERMISSION_RESET_FAILED
      557 |                 expect.stringContaining('Échoué (API: 500)'),
      558 |                 expect.anything(), // AuditSeverity.ERROR

      at Object.<anonymous> (src/modules/leaves/permissions/__tests__/LeavePermissionService.test.ts:555:66)

FAIL src/lib/auth/__tests__/authorization.test.ts
  ● Authorization Module › Tests de sécurité › devrait valider tous les paramètres d'entrée

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      370 |
      371 |             // Test avec des rôles invalides
    > 372 |             expect(hasRole(regularUser, 'INVALID_ROLE')).toBe(false);
          |                                                          ^
      373 |         });
      374 |
      375 |         it('devrait empêcher l\'escalade de privilèges', () => {

      at Object.<anonymous> (src/lib/auth/__tests__/authorization.test.ts:372:58)

FAIL src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts
  ● ConflictRecommendationService › analyzeConflicts › devrait identifier correctement les résolutions automatiques possibles

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      134 |
      135 |             // Vérifier que l'événement a été émis pour les résolutions automatiques
    > 136 |             expect(mockEventBus.emit).toHaveBeenCalled();
          |                                       ^
      137 |         });
      138 |
      139 |         it('devrait calculer correctement la distribution des priorités', () => {

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:136:39)

  ● ConflictRecommendationService › updateRules › devrait mettre à jour les règles et émettre un événement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"updatedBy": "user", "updatedRules": ["priorityRules"]}, "type": "conflict.rules.updated"}

    Number of calls: 0

      186 |
      187 |             // Vérifier que l'événement a été émis
    > 188 |             expect(mockEventBus.emit).toHaveBeenCalledWith({
          |                                       ^
      189 |                 type: 'conflict.rules.updated',
      190 |                 data: {
      191 |                     updatedRules: Object.keys(newRules),

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:188:39)

  ● ConflictRecommendationService › resetRulesToDefault › devrait réinitialiser les règles aux valeurs par défaut

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"resetToDefault": true, "updatedBy": "user", "updatedRules": ["all"]}, "type": "conflict.rules.updated"}

    Number of calls: 0

      215 |
      216 |             // Vérifier que l'événement a été émis
    > 217 |             expect(mockEventBus.emit).toHaveBeenCalledWith({
          |                                       ^
      218 |                 type: 'conflict.rules.updated',
      219 |                 data: {
      220 |                     updatedRules: ['all'],

      at Object.<anonymous> (src/modules/leaves/services/__tests__/conflictRecommendationService.test.ts:217:39)

FAIL src/modules/leaves/services/leaveCalculator.test.ts
  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement les jours pour une période standard

    expect(received).toBe(expected) // Object.is equality

    Expected: 5
    Received: 0

      48 |
      49 |             expect(result).not.toBeNull();
    > 50 |             expect(result?.countedDays).toBe(5);
         |                                         ^
      51 |             expect(result?.naturalDays).toBe(5);
      52 |             expect(result?.halfDays).toBe(0);
      53 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:50:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement une demi-journée du matin

    expect(received).toBe(expected) // Object.is equality

    Expected: 0.5
    Received: 0

      63 |
      64 |             expect(result).not.toBeNull();
    > 65 |             expect(result?.countedDays).toBe(0.5);
         |                                         ^
      66 |             expect(result?.naturalDays).toBe(1);
      67 |             expect(result?.halfDays).toBe(1);
      68 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:65:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait calculer correctement une demi-journée de l'après-midi

    expect(received).toBe(expected) // Object.is equality

    Expected: 0.5
    Received: 0

      78 |
      79 |             expect(result).not.toBeNull();
    > 80 |             expect(result?.countedDays).toBe(0.5);
         |                                         ^
      81 |             expect(result?.naturalDays).toBe(1);
      82 |             expect(result?.halfDays).toBe(1);
      83 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:80:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait ignorer isHalfDay si startDate et endDate sont différents

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      94 |
      95 |             expect(result).not.toBeNull();
    > 96 |             expect(result?.countedDays).toBe(2); // Devrait compter 2 jours complets
         |                                         ^
      97 |             expect(result?.naturalDays).toBe(2);
      98 |             expect(result?.halfDays).toBe(0);
      99 |         });

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:96:41)

  ● leaveCalculator › calculateLeaveCountedDays › devrait prendre en compte les jours fériés

    expect(received).toBe(expected) // Object.is equality

    Expected: 4
    Received: 0

      115 |
      116 |             expect(result).not.toBeNull();
    > 117 |             expect(result?.countedDays).toBe(4); // 5 jours - 1 jour férié
          |                                         ^
      118 |             expect(result?.naturalDays).toBe(5);
      119 |         });
      120 |

      at Object.<anonymous> (src/modules/leaves/services/leaveCalculator.test.ts:117:41)

FAIL src/modules/leaves/hooks/useLeave.test.ts
  ● useLeave Hook › should initialize with null leave and empty leaves array when no initialLeave provided

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      172 |         expect(result.current.leave).toBeNull();
      173 |         expect(result.current.leaves).toEqual([]);
    > 174 |         expect(result.current.loading).toBe(false);
          |                                        ^
      175 |         expect(result.current.error).toBeNull();
      176 |         expect(result.current.conflictCheckResult).toBeNull();
      177 |         expect(result.current.allowanceCheckResult).toBeNull();

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:174:40)

  ● useLeave Hook › checkConflicts › should call checkLeaveConflicts service with Date objects and update state on success

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      461 |
      462 |             // Vérifier que loading était true pendant l'appel
    > 463 |             expect(loadingDuringCall).toBe(true);
          |                                       ^
      464 |
      465 |             // Vérifier les états après l'appel
      466 |             expect(result.current.loading).toBe(false);

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:463:39)

  ● useLeave Hook › checkConflicts › should return null if userId is missing

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: 2024-09-01T22:00:00.000Z, 2024-09-05T22:00:00.000Z, "user123", "leave-initial"

      589 |
      590 |             // Vérifier que le service n'a pas été appelé
    > 591 |             expect(mockedCheckLeaveConflicts).not.toHaveBeenCalled();
          |                                                   ^
      592 |
      593 |             // Vérifier que setError a été appelé avec les informations appropriées
      594 |             expect(mockedSetError).toHaveBeenCalledWith(

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:591:51)

  ● useLeave Hook › fetchUserLeaves › should set error state if fetchLeaves service fails

    Fetch leaves failed

      1097 |
      1098 |         it('should set error state if fetchLeaves service fails', async () => {
    > 1099 |             const mockError = new Error('Fetch leaves failed');
           |                               ^
      1100 |             mockedFetchLeaves.mockRejectedValueOnce(mockError);
      1101 |
      1102 |             const { result } = renderHook(() => useLeave({ userId: mockUserId }));

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1099:31)

  ● useLeave Hook › fetchUserLeaves › should set error state if fetchLeaves service fails

    expect(received).toEqual(expected) // deep equality

    - Expected  -  1
    + Received  + 14

    - Array []
    + Array [
    +   Object {
    +     "countedDays": 5,
    +     "createdAt": 2024-07-31T22:00:00.000Z,
    +     "endDate": 2024-09-05T22:00:00.000Z,
    +     "id": "leave-initial",
    +     "requestDate": 2024-07-31T22:00:00.000Z,
    +     "startDate": 2024-09-01T22:00:00.000Z,
    +     "status": "DRAFT",
    +     "type": "ANNUAL",
    +     "updatedAt": 2024-07-31T22:00:00.000Z,
    +     "userId": "user123",
    +   },
    + ]

      1119 |                 severity: 'error'
      1120 |             });
    > 1121 |             expect(result.current.leaves).toEqual([]); // Liste reste vide
           |                                           ^
      1122 |         });
      1123 |     });
      1124 |

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1121:43)

  ● useLeave Hook › fetchLeaveDetails › should set error state if fetchLeaveById service fails

    Fetch details failed

      1146 |         it('should set error state if fetchLeaveById service fails', async () => {
      1147 |             const specificLeaveId = 'leave-fail';
    > 1148 |             const mockError = new Error('Fetch details failed');
           |                               ^
      1149 |             mockedFetchLeaveById.mockRejectedValueOnce(mockError);
      1150 |
      1151 |             const { result } = renderHook(() => useLeave({ userId: mockUserId }));

      at Object.<anonymous> (src/modules/leaves/hooks/useLeave.test.ts:1148:31)

FAIL src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx
  ● useQuotaTransfer › devrait charger les données initiales

    expect(received).not.toBeNull()

    Received: null

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      130 |         expect(result.current.error).toBeNull();
      131 |
    > 132 |         await waitFor(() => expect(result.current.balance).not.toBeNull());
          |                                                                ^
      133 |
      134 |         // Vérifier l'état après chargement
      135 |         expect(result.current.loading).toBe(false);

      at src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:132:64
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useQuotaTransfer › devrait calculer correctement les types disponibles

    expect(received).toContain(expected) // indexOf

    Expected value: "ANNUAL"
    Received array: []

      151 |
      152 |         // Vérifier les types sources disponibles
    > 153 |         expect(result.current.availableSourceTypes).toContain(LeaveType.ANNUAL);
          |                                                     ^
      154 |         expect(result.current.availableSourceTypes).toContain(LeaveType.RECOVERY);
      155 |
      156 |         // Vérifier les types cibles disponibles par source

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:153:53)

  ● useQuotaTransfer › devrait simuler un transfert correctement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"sourceAmount": 5, "sourceType": "RECOVERY", "targetType": "ANNUAL", "userId": "mock-user-id"}, [{"createdAt": 2025-05-26T14:56:03.078Z, "id": "rule-1", "isActive": true, "name": "Récupération vers Congés Annuels", "ratio": 1, "ruleType": "STANDARD", "sourceType": "RECOVERY", "targetType": "ANNUAL", "updatedAt": 2025-05-26T14:56:03.078Z}]

    Number of calls: 0

      188 |
      189 |         // Vérifier les appels et le résultat
    > 190 |         expect(previewQuotaTransfer).toHaveBeenCalledWith(transferRequest, applicableRules);
          |                                      ^
      191 |         expect(simulationResult).toMatchObject({
      192 |             success: true,
      193 |             sourceAmount: 5,

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:190:38)

  ● useQuotaTransfer › devrait exécuter un transfert correctement

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"sourceAmount": 5, "sourceType": "RECOVERY", "targetType": "ANNUAL", "userId": "mock-user-id"}

    Number of calls: 0

      221 |
      222 |         // Vérifier les appels et le résultat
    > 223 |         expect(transferQuota).toHaveBeenCalledWith(transferRequest);
          |                               ^
      224 |         expect(fetchLeaveBalance).toHaveBeenCalledTimes(2);
      225 |         expect(transferResult).toEqual(mockTransferResult);
      226 |     });

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:223:31)

  ● useQuotaTransfer › devrait gérer les erreurs de transfert

    expect(received).toBe(expected) // Object.is equality

    Expected: "Erreur lors du transfert"
    Received: "Aucune règle de transfert n'est disponible pour Récupération vers Congés annuels"

      304 |         expect(transferResult.success).toBe(false);
      305 |         expect(result.current.transferError).toBeInstanceOf(Error);
    > 306 |         expect(result.current.transferError?.message).toBe(errorMessage);
          |                                                       ^
      307 |     });
      308 | }); 

      at Object.<anonymous> (src/modules/leaves/quotas/transfer/__tests__/useQuotaTransfer.test.tsx:306:55)

FAIL src/modules/leaves/services/conflictDetectionService.test.ts
  ● Test suite failed to run

    Configuration error:

    Could not locate module @/modules/teams/services/teamService mapped as:
    /Users/vincentperreard/Mathildanesth/src/modules/$1.

    Please check your configuration for these entries:
    {
      "moduleNameMapper": {
        "/^@\/modules\/(.*)$/": "/Users/vincentperreard/Mathildanesth/src/modules/$1"
      },
      "resolver": undefined
    }

       8 |
       9 | jest.mock('../../../services/userService');
    > 10 | jest.mock('@/modules/teams/services/teamService');
         |      ^
      11 | jest.mock('../../../utils/performanceLogger');
      12 |
      13 | const MockUserService = UserService as jest.MockedClass<typeof UserService>;

      at createNoMappedModuleFoundError (node_modules/jest-resolve/build/resolver.js:759:17)
      at Object.<anonymous> (src/modules/leaves/services/conflictDetectionService.test.ts:10:6)

FAIL src/modules/leaves/services/__tests__/leaveService.test.ts
  ● Test suite failed to run

    ReferenceError: Cannot access 'serviceMocks_1' before initialization

      36 | // Mock Prisma
      37 | jest.mock('@/lib/prisma', () => ({
    > 38 |     prisma: mockPrismaClient,
         |             ^
      39 | }));
      40 |
      41 | // Mock des utilitaires

      at src/modules/leaves/services/__tests__/leaveService.test.ts:38:13
      at Object.require (src/modules/leaves/services/leaveService.ts:43:1)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/leaveService.test.ts:7:1)

FAIL src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts
  ● Test suite failed to run

    Cannot find module '../../profiles/services/workScheduleService' from 'src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts'

      13 | import { TestFactory } from '@/tests/factories/testFactorySimple';
      14 | import { publicHolidayService } from '../publicHolidayService';
    > 15 | import { isWorkingDay } from '../../profiles/services/workScheduleService';
         | ^
      16 | import { WorkSchedule, WorkFrequency } from '../../profiles/types/workSchedule';
      17 | import { getLogger } from '@/utils/logger';
      18 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/modules/leaves/services/__tests__/leaveCalculator.comprehensive.test.ts:15:1)

FAIL src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts (5.422 s)
  ● useConflictDetection › devrait initialiser correctement l'état et vérifier les conflits

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      86 |
      87 |         // Attendre la fin du chargement
    > 88 |         await waitFor(() => expect(result.current.loading).toBe(false));
         |                                                            ^
      89 |
      90 |         // Assert : vérifier que la méthode du *service* a été appelée (indirectement par le hook)
      91 |         // Il faut peut-être ajuster ce que le hook passe au service

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:88:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - resolveConflict › devrait appeler le service (indirectement) et mettre à jour l'état après résolution

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      160 |         // Charger les conflits initiaux en appelant checkConflicts avec des objets Date
      161 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 162 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      163 |         expect(result.current.conflicts).toEqual(initialConflictsResult.conflicts);
      164 |         expect(result.current.hasBlockingConflicts).toBe(true);
      165 |

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:162:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - resolveConflict › devrait gérer les erreurs lors de la résolution

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      202 |         // Charger les conflits initiaux en appelant checkConflicts avec des objets Date
      203 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 204 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      205 |
      206 |         // Act : Appeler resolveConflict du hook. On s'attend à ce qu'il échoue.
      207 |         // Pour simuler l'échec, on pourrait mocker une dépendance ou modifier le hook

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:204:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● useConflictDetection - getConflictsByType › devrait filtrer les conflits par type

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

      244 |         // Charger les conflits en appelant checkConflicts avec des objets Date
      245 |         act(() => { result.current.checkConflicts(mockStartDateObj, mockEndDateObj); });
    > 246 |         await waitFor(() => expect(result.current.loading).toBe(false));
          |                                                            ^
      247 |
      248 |         // Act & Assert : Appeler getConflictsByType du *hook*
      249 |         expect(result.current.getConflictsByType(ConflictType.USER_LEAVE_OVERLAP)).toEqual([mockConflicts[0]]);

      at src/modules/leaves/hooks/__tests__/useConflictDetection.test.ts:246:60
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/modules/leaves/components/UserLeaveBalance.test.tsx (6.265 s)
  ● UserLeaveBalance Component › affiche correctement les soldes de congés

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      74 |
      75 |         expectToBeInDocument(screen.getByText('Chargement des soldes...'));
    > 76 |         await waitFor(() => {
         |                      ^
      77 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      78 |         });
      79 |

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:76:22)

  ● UserLeaveBalance Component › affiche un message d'erreur si le chargement échoue

    Unable to find an element with the text: Erreur. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

       97 |         mockedAxios.get.mockRejectedValueOnce(new Error('Network error'));
       98 |         render(<UserLeaveBalance userId={123} />);
    >  99 |         await waitFor(() => {
          |                      ^
      100 |             expectToBeInDocument(screen.getByText('Erreur'));
      101 |         });
      102 |         expectToBeInDocument(screen.getByText('Impossible de charger les soldes de congés'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:99:22)

  ● UserLeaveBalance Component › affiche un message si aucun solde n'est disponible

    Unable to find an element with the text: Aucun solde disponible. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      106 |         mockedAxios.get.mockResolvedValueOnce({ data: [] });
      107 |         render(<UserLeaveBalance userId={123} />);
    > 108 |         await waitFor(() => {
          |                      ^
      109 |             expectToBeInDocument(screen.getByText('Aucun solde disponible'));
      110 |         });
      111 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:108:22)

  ● UserLeaveBalance Component › respecte l'option compact=true en masquant les détails

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"font-semibold tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-tertiary-600 bg-clip-text text-transparent text-lg"[39m
              [33mstyle[39m=[32m"background-clip: text;"[39m
            [36m>[39m
              [0mChargement des soldes...[0m
            [36m</h3>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      114 |         mockedAxios.get.mockResolvedValueOnce({ data: mockBalanceData });
      115 |         render(<UserLeaveBalance userId={123} compact={true} />);
    > 116 |         await waitFor(() => {
          |                      ^
      117 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      118 |         });
      119 |         expectToBeInDocument(screen.getByText('15.5 jours'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:116:22)

  ● UserLeaveBalance Component › respecte l'option hideHeader=true

    Unable to find an element with the text: Congé Annuel. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm dark:bg-slate-800 dark:border-slate-700 w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"p-6 pt-0"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"animate-pulse rounded-md bg-muted h-4 w-full"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      126 |         mockedAxios.get.mockResolvedValueOnce({ data: mockBalanceData });
      127 |         render(<UserLeaveBalance userId={123} hideHeader={true} />);
    > 128 |         await waitFor(() => {
          |                      ^
      129 |             expectToBeInDocument(screen.getByText('Congé Annuel'));
      130 |         });
      131 |         expectNotToBeInDocument(screen.queryByText('Soldes de congés'));

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/UserLeaveBalance.test.tsx:128:22)

FAIL src/modules/leaves/components/LeaveForm.test.tsx (12.75 s)
  ● LeaveForm › should handle error when loading leave types

    Unable to find an element with the display value: Erreur de chargement.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0mChargement...[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"endDate"[39m
                [36m>[39m
                  [0mDate de fin[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"endDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col space-y-4 p-4 bg-gray-50 rounded-md border border-gray-200"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center"[39m
                [36m>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mid[39m=[32m"isHalfDay"[39m
                    [33mname[39m=[32m"isHalfDay"[39m
                    [33mtype[39m=[32m"checkbox"[39m
                  [36m/>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"ml-2 block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"isHalfDay"[39m
                  [36m>[39m
                    [0mDemi-journée[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help ml-1"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3 mb-6"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"reason"[39m
                [36m>[39m
                  [0mMotif (optionnel)[0m
                [36m</label>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mMax. 200 caractères[0m
                [36m</span>[39m
              [36m</div>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"[39m
                [33mid[39m=[32m"reason"[39m
                [33mmaxlength[39m=[32m"200"[39m
                [33mname[39m=[32m"reason"[39m
                [33mplaceholder[39m=[32m"Précisez le motif de votre demande si nécessaire..."[39m
                [33mrows[39m=[32m"3"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex justify-end mt-8"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-opacity"[39m
              [33mdisabled[39m=[32m""[39m
              [33mtype[39m=[32m"submit"[39m
            [36m>[39m
              [0mSoumettre la demande[0m
            [36m</button>[39m
          [36m</div>[39m
        [36m</form>[39m
      [36m</div>[39m
    [36m</body>[39m

      258 |         (global.fetch as jest.Mock).mockRejectedValue(new Error('Failed to fetch types'));
      259 |         renderTheForm();
    > 260 |         await waitFor(() => {
          |                      ^
      261 |             expectToBeInDocument(screen.getByDisplayValue('Erreur de chargement'));
      262 |         });
      263 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:260:22)

  ● LeaveForm › should call useLeaveCalculation with initial dates and options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"endDate": null, "options": {"countHalfDays": false, "halfDayPeriod": undefined}, "startDate": null}
    Received
           1
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },
           2
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },

    Number of calls: 2

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:267:35)

  ● LeaveForm › should update useLeaveCalculation when dates change

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"endDate": null, "options": {"countHalfDays": false, "halfDayPeriod": undefined}, "startDate": null}
    Received
           1
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },
           2
              Object {
                "endDate": null,
                "options": Object {
            -     "countHalfDays": false,
                  "halfDayPeriod": undefined,
            +     "isHalfDay": false,
                },
                "startDate": null,
              },

    Number of calls: 2

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:280:35)

  ● LeaveForm › should handle half-day selection

    expect(element).toBeChecked()

    Received element is not checked:
      <input class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" disabled="" id="isHalfDay" name="isHalfDay" type="checkbox" />

      73 |  */
      74 | export function expectToBeChecked(element: HTMLElement | null | undefined): void {
    > 75 |     expect(element).toBeChecked();
         |                     ^
      76 | }
      77 |
      78 | /**

      at expectToBeChecked (src/tests/utils/assertions.ts:75:21)
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:346:26)

  ● LeaveForm › should validate form on submit and show errors if invalid

    Unable to find an element with the text: La date de début est requise.. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0mChargement...[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"endDate"[39m
                [36m>[39m
                  [0mDate de fin[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                        [33mid[39m=[32m"endDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M8 2v4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M16 2v4"[39m
                      [36m/>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"18"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"18"[39m
                        [33mx[39m=[32m"3"[39m
                        [33my[39m=[32m"4"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M3 10h18"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col space-y-4 p-4 bg-gray-50 rounded-md border border-gray-200"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center"[39m
                [36m>[39m
                  [36m<input[39m
                    [33mclass[39m=[32m"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mid[39m=[32m"isHalfDay"[39m
                    [33mname[39m=[32m"isHalfDay"[39m
                    [33mtype[39m=[32m"checkbox"[39m
                  [36m/>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"ml-2 block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"isHalfDay"[39m
                  [36m>[39m
                    [0mDemi-journée[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help ml-1"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"space-y-3 mb-6"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"reason"[39m
                [36m>[39m
                  [0mMotif (optionnel)[0m
                [36m</label>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mMax. 200 caractères[0m
                [36m</span>[39m
              [36m</div>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"[39m
                [33mid[39m=[32m"reason"[39m
                [33mmaxlength[39m=[32m"200"[39m
                [33mname[39m=[32m"reason"[39m
                [33mplaceholder[39m=[32m"Précisez le motif de votre demande si nécessaire..."[39m
                [33mrows[39m=[32m"3"[39m
              [36m/>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex justify-end mt-8"[39m
          [36m>[39m
            [36m<button[39m
              [33mclass[39m=[32m"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-opacity"[39m
              [33mdisabled[39m=[32m""[39m
              [33mtype[39m=[32m"submit"[39m
            [36m>[39m
              [0mSoumettre la demande[0m
            [36m</button>[39m
          [36m</div>[39m
        [36m</form>[39m
      [36m</div>[39m
    [36m</body>[39m

      406 |         await user.click(submitButton); // Soumission sans dates
      407 |
    > 408 |         expectToBeInDocument(await screen.findByText('La date de début est requise.'));
          |                                           ^
      409 |         expectToBeInDocument(screen.getByText('La date de fin est requise.'));
      410 |         expectNotToHaveBeenCalled(mockedAxios.post);
      411 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:32
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:408:43)

  ● LeaveForm › Form Submission › should submit valid data to /api/leaves/batch and handle success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", [ObjectContaining {"endDate": "2024-09-03", "reason": "Vacances annuelles", "startDate": "2024-09-02", "typeCode": "ANNUAL", "userId": 1}]

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:507:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should handle API error from /api/leaves/batch on submit

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", Any<Array>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:572:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should handle general network error on submit

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/leaves/batch", Any<Array>

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<form[39m
            [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
              [36m>[39m
                [0mNouvelle demande de congé[0m
              [36m</h3>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm text-gray-600"[39m
              [36m>[39m
                [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-between"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                    [33mfor[39m=[32m"leaveType"[39m
                  [36m>[39m
                    [0mType de congé[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative inline-block"[39m
                  [36m>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"12"[39m
                          [33mcy[39m=[32m"12"[39m
                          [33mr[39m=[32m"10"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"M12 17h.01"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mt-1 relative"[39m
                [36m>[39m
                  [36m<select[39m
                    [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                    [33mid[39m=[32m"leaveType"[39m
                    [33mname[39m=[32m"leaveType"[39m
                    [33mrequired[39m=[32m""[39m
                  [36m>[39m
                    [36m<option[39m
                      [33mvalue[39m=[32m""[39m
                    [36m>[39m
                      [0m-- Sélectionner un type --[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congés annuels bruts"[39m
                      [33mvalue[39m=[32m"ANNUAL"[39m
                    [36m>[39m
                      [0mCongé annuel[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"RTT bruts"[39m
                      [33mvalue[39m=[32m"RTT"[39m
                    [36m>[39m
                      [0mRTT API (Raw)[0m
                    [36m</option>[39m
                    [36m<option[39m
                      [33mtitle[39m=[32m"Congé maladie brut"[39m
                      [33mvalue[39m=[32m"SICK"[39m
                    [36m>[39m
                      [0mMaladie[0m
                    [36m</option>[39m
                  [36m</select>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                    [33mfor[39m=[32m"startDate"[39m
                  [36m>[39m
                    [0mDate de début[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"react-datepicker__input-container"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33mautocomplete[39m=[32m"off"[39m
                          [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed"[39m
                          [33mid[39m=[32m"startDate"[39m
                          [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33maria-hidden[39m=[32m"true"[39m
                        [33mclass[39m=[32m"lucide lucide-calendar h-5 w-5 text-gray-400"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
            ...

      45 |  */
      46 | export function expectToHaveBeenCalledWith(mockFn: MockFn, ...args: any[]): void {
    > 47 |     expect(mockFn).toHaveBeenCalledWith(...args);
         |                    ^
      48 | }
      49 |
      50 | /**

      at expectToHaveBeenCalledWith (src/tests/utils/assertions.ts:47:20)
      at src/modules/leaves/components/LeaveForm.test.tsx:611:43
      at callback (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:76)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● LeaveForm › Form Submission › should not submit if calculation is not successful

    Unable to find an element with the text: /Calcul des jours en cours.../i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<form[39m
          [33mclass[39m=[32m"space-y-6 max-w-2xl mx-auto"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg shadow-sm mb-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-gray-800 mb-2"[39m
            [36m>[39m
              [0mNouvelle demande de congé[0m
            [36m</h3>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-sm text-gray-600"[39m
            [36m>[39m
              [0mComplétez le formulaire ci-dessous pour soumettre votre demande.[0m
            [36m</p>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-white p-6 rounded-lg shadow-md border border-gray-200"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700"[39m
                  [33mfor[39m=[32m"leaveType"[39m
                [36m>[39m
                  [0mType de congé[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative inline-block"[39m
                [36m>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"text-gray-400 hover:text-gray-600 cursor-help"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33maria-hidden[39m=[32m"true"[39m
                      [33mclass[39m=[32m"lucide lucide-circle-help h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<circle[39m
                        [33mcx[39m=[32m"12"[39m
                        [33mcy[39m=[32m"12"[39m
                        [33mr[39m=[32m"10"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"[39m
                      [36m/>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 17h.01"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mt-1 relative"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"block w-full rounded-md border-gray-300 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm py-2 px-3"[39m
                  [33mid[39m=[32m"leaveType"[39m
                  [33mname[39m=[32m"leaveType"[39m
                  [33mrequired[39m=[32m""[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m""[39m
                  [36m>[39m
                    [0m-- Sélectionner un type --[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"Congés annuels bruts"[39m
                    [33mvalue[39m=[32m"ANNUAL"[39m
                  [36m>[39m
                    [0mCongé annuel[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"RTT bruts"[39m
                    [33mvalue[39m=[32m"RTT"[39m
                  [36m>[39m
                    [0mRTT API (Raw)[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mtitle[39m=[32m"Congé maladie brut"[39m
                    [33mvalue[39m=[32m"SICK"[39m
                  [36m>[39m
                    [0mMaladie[0m
                  [36m</option>[39m
                [36m</select>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"grid grid-cols-1 gap-6 md:grid-cols-2 mb-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"relative"[39m
              [36m>[39m
                [36m<label[39m
                  [33mclass[39m=[32m"block text-sm font-medium text-gray-700 mb-1"[39m
                  [33mfor[39m=[32m"startDate"[39m
                [36m>[39m
                  [0mDate de début[0m
                [36m</label>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"relative"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker-wrapper"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__input-container"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33mautocomplete[39m=[32m"off"[39m
                        [33mclass[39m=[32m"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pl-10 pr-4 py-2 disabled:bg-gray-100 disabled:cursor-not-allowed react-datepicker-ignore-onclickoutside"[39m
                        [33mid[39m=[32m"startDate"[39m
                        [33mplaceholder[39m=[32m"Sélectionner une date"[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"02/09/2024"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"react-datepicker__tab-loop"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker__tab-loop__start"[39m
                      [33mtabindex[39m=[32m"0"[39m
                    [36m/>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"react-datepicker-popper z-50"[39m
                      [33mdata-placement[39m=[32m"bottom"[39m
                      [33mstyle[39m=[32m"position: absolute; left: 0px; top: 0px; transform: translate(0px, 10px);"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mstyle[39m=[32m"display: contents;"[39m
                      [36m>[39m
                        [36m<div[39m
                          [33mstyle[39m=[32m"display: contents;"[39m
                        [36m>[39m
                          [36m<div[39m
                            [33maria-label[39m=[32m"Choose Date"[39m
                            [33maria-modal[39m=[32m"true"[39m
                            [33mclass[39m=[32m"react-datepicker shadow-lg rounded-md border bo...

      653 |             await fillDatesInForm(user, '02/09/2024', '03/09/2024');
      654 |             // Le hook est mocké pour retourner 'loading' avec ces dates.
    > 655 |             await screen.findByText(/Calcul des jours en cours.../i, {}, { timeout: 3000 });
          |                          ^
      656 |
      657 |             const submitButton = screen.getByText('Soumettre la demande');
      658 |             await user.click(submitButton);

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:32
      at Object.<anonymous> (src/modules/leaves/components/LeaveForm.test.tsx:655:26)


Test Suites: 17 failed, 3 skipped, 16 passed, 33 of 36 total
Tests:       67 failed, 14 skipped, 376 passed, 457 total
Snapshots:   0 total
Time:        21.595 s
Ran all test suites matching /src\/modules\/leaves|src\/lib\/auth/i.
</small>
            </div>
        

        
        <div class="recommendations">
            <h2>💡 Recommandations</h2>
            <ul>
                <li>Bundle total trop volumineux. Considérer le code splitting.</li><li>42 fichiers volumineux détectés. Optimiser ou diviser.</li>
            </ul>
        </div>
        
    </div>
</body>
</html>
#!/bin/bash
# scripts/etape-simple - Version simplifiÃ©e pour dÃ©butants

echo "ğŸ‘‹ Salut ! Analysons votre projet..."
echo ""

# MÃ©triques simples avec explications
ROUTES=$(find src/app/api -name "route.ts" 2>/dev/null | wc -l)
TODOS=$(grep -r "TODO\|FIXME" src --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l)
TESTS=$(find src -name "*.test.ts" -o -name "*.test.tsx" 2>/dev/null | wc -l)
ERRORS=$(grep -r "@ts-ignore" src --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l)

echo "ğŸ“Š Ã‰TAT DE VOTRE PROJET"
echo "======================"

# Routes API (fonctionnalitÃ©s)
if [ "$ROUTES" -gt 100 ]; then
    echo "ğŸš€ FonctionnalitÃ©s : $ROUTES routes API - EXCELLENT ! Votre app a plein de fonctionnalitÃ©s"
elif [ "$ROUTES" -gt 50 ]; then
    echo "ğŸ‘ FonctionnalitÃ©s : $ROUTES routes API - TrÃ¨s bien, bonne base"
else
    echo "ğŸŒ± FonctionnalitÃ©s : $ROUTES routes API - En dÃ©veloppement, c'est normal"
fi

# TODO (choses Ã  faire)
if [ "$TODOS" -lt 30 ]; then
    echo "âœ… Choses Ã  faire : $TODOS TODO - Super ! Vous Ãªtes bien organisÃ©"
elif [ "$TODOS" -lt 80 ]; then
    echo "ğŸ“ Choses Ã  faire : $TODOS TODO - Normal, vous avez des idÃ©es d'amÃ©lioration"
else
    echo "âš ï¸  Choses Ã  faire : $TODOS TODO - Beaucoup ! Prenez le temps de trier les prioritÃ©s"
fi

# Tests (vÃ©rifications)
if [ "$TESTS" -gt 100 ]; then
    echo "ğŸ›¡ï¸  Tests : $TESTS fichiers - EXCELLENT ! Votre code est bien protÃ©gÃ©"
elif [ "$TESTS" -gt 50 ]; then
    echo "ğŸ§ª Tests : $TESTS fichiers - Bien, continuez Ã  tester votre code"
else
    echo "ğŸ” Tests : $TESTS fichiers - Ã€ amÃ©liorer, les tests protÃ¨gent votre travail"
fi

# Erreurs TypeScript
if [ "$ERRORS" -lt 10 ]; then
    echo "ğŸ’ QualitÃ© code : $ERRORS erreurs masquÃ©es - PARFAIT ! Code trÃ¨s propre"
elif [ "$ERRORS" -lt 25 ]; then
    echo "âš ï¸  QualitÃ© code : $ERRORS erreurs masquÃ©es - Quelques problÃ¨mes Ã  corriger"
else
    echo "ğŸš¨ QualitÃ© code : $ERRORS erreurs masquÃ©es - ATTENTION ! Beaucoup d'erreurs cachÃ©es"
fi

echo ""
echo "ğŸ¯ QUE FAIRE MAINTENANT ?"
echo "========================"

# Conseils personnalisÃ©s
if [ "$ERRORS" -gt 20 ]; then
    echo "ğŸ”§ PRIORITÃ‰ 1 : Corriger les erreurs TypeScript (qualitÃ© du code)"
    echo "   Commande : npm run audit:debt"
elif [ "$TODOS" -gt 100 ]; then
    echo "ğŸ“‹ PRIORITÃ‰ 1 : Trier vos TODO et traiter les urgents"
    echo "   Commande : npm run etape:roadmap"
elif [ "$TESTS" -lt 50 ]; then
    echo "ğŸ§ª PRIORITÃ‰ 1 : Ajouter plus de tests pour sÃ©curiser votre code"
    echo "   Les tests vous Ã©vitent de casser votre application"
else
    echo "ğŸ‰ BRAVO ! Votre projet est en bonne santÃ© !"
    echo "   Continuez comme Ã§a et lancez 'npm run etape' pour plus de dÃ©tails"
fi

echo ""
echo "ğŸ’¡ COMMANDES UTILES POUR DÃ‰BUTER"
echo "================================="
echo "npm run etape:quick     â†’ VÃ©rification rapide (10 secondes)"
echo "npm run etape          â†’ Analyse complÃ¨te (2 minutes)" 
echo "npm run etape:roadmap  â†’ Voir ce qu'il faut faire en prioritÃ©"
echo "npm run build          â†’ VÃ©rifier que tout compile bien"
echo ""
echo "â“ Besoin d'aide ? Demandez Ã  Claude : 'Explique-moi les rÃ©sultats de mon point d'Ã©tape'" 